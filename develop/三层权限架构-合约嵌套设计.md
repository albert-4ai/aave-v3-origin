# ä¸‰å±‚æƒé™æ¶æ„ - åˆçº¦åµŒå¥—è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ä¸‰å±‚æƒé™æ¶æ„ä¸­"åˆçº¦åµŒå¥—"ï¼ˆContract Nestingï¼‰çš„è®¾è®¡ç†å¿µå’Œå®ç°æœºåˆ¶ã€‚è¿™æ˜¯å®ç°å»ä¸­å¿ƒåŒ–æƒé™æ§åˆ¶çš„æ ¸å¿ƒé­”æ³•ã€‚

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼šåœ°å€çš„"äºŒè±¡æ€§"

åœ¨ EVMï¼ˆä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰çš„ä¸–ç•Œé‡Œï¼Œ`address` å‚æ•°å…·æœ‰"äºŒè±¡æ€§"ï¼š

### 1. EOA (External Owned Account)
- **å®šä¹‰**: ç”±ç§é’¥æ§åˆ¶çš„è´¦æˆ·
- **ç‰¹ç‚¹**: å•ç­¾æ§åˆ¶ï¼Œä¸€ä¸ªäººæ‹¥æœ‰ç§é’¥å³å¯å®Œå…¨æ§åˆ¶
- **ç¤ºä¾‹**: `0xUser...` (æ™®é€šç”¨æˆ·é’±åŒ…åœ°å€)

### 2. Contract Account (åˆçº¦è´¦æˆ·)
- **å®šä¹‰**: ç”±æ™ºèƒ½åˆçº¦ä»£ç æ§åˆ¶çš„è´¦æˆ·
- **ç‰¹ç‚¹**: æ§åˆ¶é€»è¾‘ç”±åˆçº¦ä»£ç å†³å®šï¼Œå¯ä»¥æ˜¯å¤šç­¾ã€DAOã€è‡ªåŠ¨åŒ–ç­‰
- **ç¤ºä¾‹**: `0xSafe...` (Gnosis Safe å¤šç­¾é’±åŒ…åœ°å€)

### å…³é”®æ´å¯Ÿ

**Aave åˆçº¦æ ¹æœ¬ä¸åœ¨ä¹è¿™ä¸ªåœ°å€èƒŒåæ˜¯"ä¸€ä¸ªäºº"è¿˜æ˜¯"ä¸€ç¾¤äºº"ã€‚å®ƒåªè®¤ï¼šè°æŒæœ‰è¿™ä¸ªåœ°å€çš„æ§åˆ¶æƒï¼Œè°å°±æœ‰æƒè°ƒç”¨å‡½æ•°ã€‚**

---

## ğŸ—ï¸ ä¸‰å±‚æ¶æ„çš„åµŒå¥—å…³ç³»

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€å±‚: Aave ACLManager (ä»£ç å±‚é¢)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ POOL_ADMIN_ROLE = 0x8888...8888                       â”‚ â”‚
â”‚  â”‚ (çœ‹èµ·æ¥åªæ˜¯ä¸€ä¸ªæ™®é€šçš„åœ°å€)                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ èµ‹ç»™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬äºŒå±‚: Gnosis Safe åˆçº¦ (0x8888...8888)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å†…éƒ¨é€»è¾‘: éœ€è¦ 3-of-5 ç­¾åæ‰èƒ½æ‰§è¡Œäº¤æ˜“                 â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Owners:                                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Owner 1: Alice (é“¶è¡Œèµ„äº§è´Ÿå€ºéƒ¨)                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ Owner 2: Bob (é“¶è¡Œèµ„äº§è´Ÿå€ºéƒ¨)                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Owner 3: Charlie (é£é™©ç®¡ç†éƒ¨)                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Owner 4: Dave (é£é™©ç®¡ç†éƒ¨)                        â”‚ â”‚
â”‚  â”‚  â””â”€ Owner 5: Eve (è¿è¥éƒ¨)                             â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  é˜ˆå€¼: 3 ç¥¨                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ ç”±
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸‰å±‚: å®é™…æ§åˆ¶è€… (5 ä¸ªçœŸå®çš„äºº)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ éœ€è¦è‡³å°‘ 3 ä¸ªäººç­¾åæ‰èƒ½æ‰§è¡Œæ“ä½œ                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç‚¹

1. **Aave å±‚é¢**: åªçœ‹åˆ°ä¸€ä¸ªåœ°å€ `0x8888...8888`
2. **Safe å±‚é¢**: è¯¥åœ°å€æ˜¯æ™ºèƒ½åˆçº¦ï¼Œå†…éƒ¨è¦æ±‚å¤šäººç­¾å
3. **å®é™…æ§åˆ¶**: éœ€è¦ 5 ä¸ªäººä¸­çš„è‡³å°‘ 3 ä¸ªäººç­¾å

---

## ğŸ”„ æ‰§è¡Œæµç¨‹è¯¦è§£

### åœºæ™¯ï¼š3-of-5 å¤šç­¾æ‰§è¡Œ `setReserveFactor`

#### æ­¥éª¤ 1: çº¿ä¸‹ç­¾åé˜¶æ®µ

```
Alice ç­¾å: setReserveFactor(USDC, 0.1)
Bob ç­¾å:   setReserveFactor(USDC, 0.1)
Charlie ç­¾å: setReserveFactor(USDC, 0.1)
```

**ç»“æœ**: æ”¶é›†åˆ° 3 ä¸ªç­¾åï¼ˆæ»¡è¶³ 3-of-5 é˜ˆå€¼ï¼‰

#### æ­¥éª¤ 2: æäº¤åˆ° Gnosis Safe

```
äº¤æ˜“æäº¤åˆ°: 0x8888...8888 (Gnosis Safe åˆçº¦åœ°å€)

Safe åˆçº¦å†…éƒ¨éªŒè¯:
â”œâ”€ æ£€æŸ¥ç­¾åæ•°é‡: 3 >= é˜ˆå€¼ 3 âœ“
â”œâ”€ éªŒè¯ç­¾åæœ‰æ•ˆæ€§: æ‰€æœ‰ç­¾åæ¥è‡ªæœ‰æ•ˆçš„ owners âœ“
â””â”€ éªŒè¯äº¤æ˜“æ•°æ®: äº¤æ˜“æ•°æ®ä¸€è‡´ âœ“
```

#### æ­¥éª¤ 3: Safe æ‰§è¡Œäº¤æ˜“

```
Safe åˆçº¦ä»¥ 0x8888...8888 çš„èº«ä»½è°ƒç”¨ Aave:
â”œâ”€ msg.sender = 0x8888...8888
â””â”€ è°ƒç”¨: PoolConfigurator.setReserveFactor(USDC, 0.1)
```

#### æ­¥éª¤ 4: Aave æƒé™æ£€æŸ¥

```
è°ƒç”¨é“¾:
PoolConfigurator._onlyRiskOrPoolAdmins()
  â””â”€ ACLManager.isPoolAdmin(0x8888...8888)
     â””â”€ MultisigRoleAdapter.hasRole(POOL_ADMIN_ROLE, 0x8888...8888)
        â”œâ”€ æ£€æŸ¥: account (0x8888...8888) == multisig (0x8888...8888) âœ“
        â””â”€ æ£€æŸ¥: msg.sender (0x8888...8888) == multisig (0x8888...8888) âœ“
        â””â”€ è¿”å›: true
```

**å…³é”®ä»£ç ** (`MultisigRoleAdapter.sol:73-89`):

```solidity
function hasRole(bytes32 role, address account) public view override returns (bool) {
    address multisig = _roleMultisigs[role];
    
    if (multisig != address(0)) {
        if (account == multisig) {
            // éªŒè¯è°ƒç”¨æ¥è‡ªå¤šç­¾é’±åŒ…æœ¬èº«
            // Safe å†…éƒ¨å·²éªŒè¯å¤šç­¾ç­¾åï¼Œæˆ‘ä»¬åªéœ€éªŒè¯è°ƒç”¨æ¥æº
            return msg.sender == multisig;
        }
    }
    
    // å›é€€åˆ°æ ‡å‡† AccessControl æ£€æŸ¥
    return AccessControl(address(ACL_MANAGER)).hasRole(role, account);
}
```

#### æ­¥éª¤ 5: æ‰§è¡Œæ“ä½œ

```
æƒé™éªŒè¯é€šè¿‡ â†’ æ‰§è¡Œ setReserveFactor(USDC, 0.1) â†’ æˆåŠŸ âœ“
```

---

## ğŸ’¡ è®¾è®¡ä¼˜åŠ¿

### 1. ä»£ç å±‚é¢ç®€æ´

- Aave åˆçº¦åªçœ‹åˆ°ä¸€ä¸ªåœ°å€ï¼Œä»£ç é€»è¾‘ç®€å•
- ä¸éœ€è¦åœ¨ Aave ä¸­å®ç°å¤æ‚çš„å¤šç­¾éªŒè¯é€»è¾‘

### 2. å®é™…æ§åˆ¶å»ä¸­å¿ƒåŒ–

- è™½ç„¶ä»£ç å±‚é¢æ˜¯"å•åœ°å€"ï¼Œä½†å®é™…éœ€è¦å¤šäººç­¾å
- é€šè¿‡åˆçº¦åµŒå¥—å®ç°å»ä¸­å¿ƒåŒ–æ§åˆ¶

### 3. Gas ä¼˜åŒ–

- å¤šç­¾éªŒè¯åœ¨ Safe åˆçº¦å†…éƒ¨å®Œæˆ
- Aave åªéœ€éªŒè¯è°ƒç”¨æ¥æºï¼ˆ`msg.sender == multisig`ï¼‰
- æ— éœ€é‡å¤éªŒè¯ç­¾åï¼Œé™ä½ Gas æˆæœ¬

### 4. å‘åå…¼å®¹

- æ”¯æŒä¼ ç»Ÿ EOA åœ°å€ï¼ˆå•ç­¾ï¼‰
- æ”¯æŒåˆçº¦åœ°å€ï¼ˆå¤šç­¾ï¼‰
- å¯ä»¥æ··åˆä½¿ç”¨ï¼ˆéƒ¨åˆ†è§’è‰²ç”¨å¤šç­¾ï¼Œéƒ¨åˆ†ç”¨å•ç­¾ï¼‰

---

## ğŸ” ä»£ç å®ç°ç»†èŠ‚

### ACLManager çš„æ”¹åŠ¨

**æ–‡ä»¶**: `src/contracts/protocol/configuration/ACLManager.sol`

#### å…³é”®æ”¹åŠ¨ç‚¹

1. **æ–°å¢çŠ¶æ€å˜é‡**:
```solidity
// Optional MultisigRoleAdapter for multisig wallet support
IMultisigRoleAdapter public multisigAdapter;

// Optional TimelockController for top-level operations
ITimelockController public timelock;
```

2. **æƒé™æ£€æŸ¥é€»è¾‘** (åŒé‡æ£€æŸ¥):
```solidity
function isPoolAdmin(address admin) external view override returns (bool) {
    // ä¼˜å…ˆçº§1: æ£€æŸ¥å¤šç­¾é’±åŒ…é€‚é…å™¨
    if (address(multisigAdapter) != address(0)) {
        if (multisigAdapter.hasRole(POOL_ADMIN_ROLE, admin)) {
            return true;
        }
    }
    // ä¼˜å…ˆçº§2: å›é€€åˆ°æ ‡å‡† AccessControl æ£€æŸ¥
    return hasRole(POOL_ADMIN_ROLE, admin);
}
```

### MultisigRoleAdapter çš„å®ç°

**æ–‡ä»¶**: `src/contracts/protocol/configuration/MultisigRoleAdapter.sol`

#### æ ¸å¿ƒé€»è¾‘

```solidity
function hasRole(bytes32 role, address account) public view override returns (bool) {
    address multisig = _roleMultisigs[role];
    
    // å¦‚æœè¯¥è§’è‰²é…ç½®äº†å¤šç­¾é’±åŒ…
    if (multisig != address(0)) {
        // æ£€æŸ¥ account æ˜¯å¦æ˜¯é…ç½®çš„å¤šç­¾é’±åŒ…
        if (account == multisig) {
            // å…³é”®æ£€æŸ¥: éªŒè¯è°ƒç”¨æ¥è‡ªå¤šç­¾é’±åŒ…æœ¬èº«
            // Safe å†…éƒ¨å·²éªŒè¯å¤šç­¾ç­¾åï¼Œæˆ‘ä»¬åªéœ€éªŒè¯è°ƒç”¨æ¥æº
            return msg.sender == multisig;
        }
    }
    
    // å›é€€åˆ°æ ‡å‡† AccessControl æ£€æŸ¥ï¼ˆæ”¯æŒ EOA æˆ–æœªé…ç½®å¤šç­¾çš„æƒ…å†µï¼‰
    return AccessControl(address(ACL_MANAGER)).hasRole(role, account);
}
```

#### æ£€æŸ¥é€»è¾‘è¯´æ˜

- `account == multisig`: ç¡®è®¤æ£€æŸ¥çš„æ˜¯å¤šç­¾é’±åŒ…åœ°å€
- `msg.sender == multisig`: ç¡®è®¤è°ƒç”¨æ¥è‡ªè¯¥å¤šç­¾é’±åŒ…
- **å…³é”®**: Safe å†…éƒ¨å·²éªŒè¯å¤šç­¾ç­¾åï¼Œæ— éœ€é‡å¤éªŒè¯

---

## ğŸ“Š ä¸‰å±‚æƒé™æ¶æ„æ˜ å°„

### é¡¶å±‚ï¼ˆä¸»æƒå±‚ï¼‰- DEFAULT_ADMIN_ROLE

```
è§’è‰²: DEFAULT_ADMIN_ROLE
å¤šç­¾é…ç½®: 4-of-5 (é“¶è¡Œ 3 ç¥¨ + å¤–éƒ¨ 2 ç¥¨)
åœ°å€: 0xTopLevelSafe...
Timelock: 7 å¤©å»¶è¿Ÿ

æ‰§è¡Œæµç¨‹:
1. é“¶è¡Œ 3 äºº + å¤–éƒ¨ 1 äººç­¾å (4 ç¥¨)
2. Safe éªŒè¯ç­¾å
3. Safe è°ƒç”¨ TimelockController.schedule()
4. ç­‰å¾… 7 å¤©
5. TimelockController.execute()
6. æ‰§è¡Œæ“ä½œ
```

### ä¸­å±‚ï¼ˆè¿è¥å±‚ï¼‰- POOL_ADMIN_ROLE & RISK_ADMIN_ROLE

```
è§’è‰²: POOL_ADMIN_ROLE, RISK_ADMIN_ROLE
å¤šç­¾é…ç½®: 3-of-5 (é“¶è¡Œå†…éƒ¨)
åœ°å€: 0xMidLevelSafe...
Timelock: æ— å»¶è¿Ÿ

æ‰§è¡Œæµç¨‹:
1. é“¶è¡Œå†…éƒ¨ 3 äººç­¾å (3 ç¥¨)
2. Safe éªŒè¯ç­¾å
3. Safe ç›´æ¥è°ƒç”¨ Aave
4. ç«‹å³æ‰§è¡Œæ“ä½œ
```

### åº•å±‚ï¼ˆç†”æ–­å±‚ï¼‰- EMERGENCY_ADMIN_ROLE

```
è§’è‰²: EMERGENCY_ADMIN_ROLE
å¤šç­¾é…ç½®: 1-of-3 (ç´§æ€¥å“åº”)
åœ°å€: 0xBottomLevelSafe...
Timelock: æ— å»¶è¿Ÿ

æ‰§è¡Œæµç¨‹:
1. 1 äººç­¾åå³å¯ (1 ç¥¨)
2. Safe éªŒè¯ç­¾å
3. Safe ç›´æ¥è°ƒç”¨ Aave
4. ç«‹å³æ‰§è¡Œæ“ä½œï¼ˆæš‚åœåè®®ç­‰ï¼‰
```

---

## ğŸ” å®‰å…¨ä¿è¯

### 1. é˜²æ­¢å•ç‚¹æ§åˆ¶

- **é¡¶å±‚**: 4-of-5 é˜ˆå€¼ç¡®ä¿é“¶è¡Œï¼ˆ3 ç¥¨ï¼‰æ— æ³•å•ç‹¬æ‰§è¡Œ
- **ä¸­å±‚**: 3-of-5 é˜ˆå€¼ç¡®ä¿éœ€è¦è·¨éƒ¨é—¨å®¡æ‰¹
- **åº•å±‚**: 1-of-3 ç”¨äºç´§æ€¥æƒ…å†µï¼Œé£é™©å¯æ¥å—

### 2. èŒè´£åˆ†ç¦»

- ä¸åŒå±‚çº§ç”±ä¸åŒå¤šç­¾é’±åŒ…æ§åˆ¶
- é¡¶å±‚æ“ä½œå¿…é¡»é€šè¿‡ Timelockï¼ˆ7 å¤©å»¶è¿Ÿï¼‰
- ä¸­å±‚æ“ä½œç›´æ¥æ‰§è¡Œï¼ˆæ— å»¶è¿Ÿï¼‰

### 3. æ˜¾æ€§æˆæƒ

- æ‰€æœ‰æ“ä½œéƒ½éœ€è¦é“¾ä¸Šç­¾å
- ç­¾åè®°å½•åœ¨åŒºå—é“¾ä¸Šï¼Œä¸å¯æŠµèµ–
- å¤šç­¾éªŒè¯åœ¨ Safe åˆçº¦å†…éƒ¨å®Œæˆ

### 4. æœ€å°æƒé™

- æ—¥å¸¸è¿è¥åªéœ€ä¸­å±‚æƒé™
- é¡¶å±‚æƒé™é€šè¿‡ Timelock å»¶è¿Ÿ
- ç´§æ€¥æƒ…å†µä½¿ç”¨åº•å±‚æƒé™

---

## ğŸ› ï¸ éƒ¨ç½²é…ç½®ç¤ºä¾‹

### é…ç½®å¤šç­¾é’±åŒ…åˆ°è§’è‰²

```solidity
// 1. éƒ¨ç½² MultisigRoleAdapter
MultisigRoleAdapter adapter = new MultisigRoleAdapter(aclManager);

// 2. é…ç½® ACLManager
aclManager.setMultisigAdapter(adapter);

// 3. æ˜ å°„è§’è‰²åˆ°å¤šç­¾é’±åŒ…
adapter.setRoleMultisig(
    aclManager.DEFAULT_ADMIN_ROLE(),
    0xTopLevelSafe... // 4-of-5 å¤šç­¾
);

adapter.setRoleMultisig(
    aclManager.POOL_ADMIN_ROLE(),
    0xMidLevelSafe... // 3-of-5 å¤šç­¾
);

adapter.setRoleMultisig(
    aclManager.EMERGENCY_ADMIN_ROLE(),
    0xBottomLevelSafe... // 1-of-3 å¤šç­¾
);
```

### éªŒè¯é…ç½®

```solidity
// æ£€æŸ¥å¤šç­¾é’±åŒ…æ˜¯å¦æœ‰æƒé™
aclManager.isPoolAdmin(0xMidLevelSafe...); // è¿”å› true

// å½“å¤šç­¾é’±åŒ…è°ƒç”¨æ—¶
// msg.sender = 0xMidLevelSafe...
// æƒé™æ£€æŸ¥é€šè¿‡ âœ“
```

---

## ğŸ“ å…³é”®ä»£ç ä½ç½®

### æ ¸å¿ƒæ–‡ä»¶

1. **ACLManager.sol**
   - è·¯å¾„: `src/contracts/protocol/configuration/ACLManager.sol`
   - åŠŸèƒ½: é›†æˆå¤šç­¾é€‚é…å™¨ï¼ŒåŒé‡æƒé™æ£€æŸ¥

2. **MultisigRoleAdapter.sol**
   - è·¯å¾„: `src/contracts/protocol/configuration/MultisigRoleAdapter.sol`
   - åŠŸèƒ½: å¤šç­¾é’±åŒ…ä¸è§’è‰²çš„æ˜ å°„å’Œæƒé™æ£€æŸ¥

3. **TimelockRoleManager.sol**
   - è·¯å¾„: `src/contracts/protocol/configuration/TimelockRoleManager.sol`
   - åŠŸèƒ½: é¡¶å±‚æ“ä½œçš„ Timelock å»¶è¿Ÿæ‰§è¡Œ

### æ¥å£æ–‡ä»¶

1. **IMultisigRoleAdapter.sol**
   - è·¯å¾„: `src/contracts/interfaces/IMultisigRoleAdapter.sol`

2. **ITimelockController.sol**
   - è·¯å¾„: `src/contracts/dependencies/openzeppelin/contracts/governance/ITimelockController.sol`

3. **ISafe.sol**
   - è·¯å¾„: `src/contracts/interfaces/ISafe.sol`

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæ€æƒ³

**"åˆçº¦åµŒå¥—"å®ç°å»ä¸­å¿ƒåŒ–çš„æ ¸å¿ƒæœºåˆ¶**ï¼š

1. **ä»£ç å±‚é¢**: Aave åªçœ‹åˆ°ä¸€ä¸ªåœ°å€ï¼ˆå¦‚ `0x8888...8888`ï¼‰
2. **å®é™…æ§åˆ¶**: è¯¥åœ°å€æ˜¯æ™ºèƒ½åˆçº¦ï¼ˆGnosis Safeï¼‰ï¼Œå†…éƒ¨è¦æ±‚å¤šäººç­¾å
3. **æ‰§è¡Œæµç¨‹**: å¤šäººç­¾å â†’ Safe éªŒè¯ â†’ Safe è°ƒç”¨ Aave â†’ Aave æ‰§è¡Œ

### è®¾è®¡åŸåˆ™

- âœ… **å‘åå…¼å®¹**: æ”¯æŒä¼ ç»Ÿ EOA å’Œåˆçº¦åœ°å€
- âœ… **æ¸è¿›å¼è¿ç§»**: å¯ä»¥é€æ­¥é…ç½®å¤šç­¾é’±åŒ…
- âœ… **Gas ä¼˜åŒ–**: å¤šç­¾éªŒè¯åœ¨ Safe å†…éƒ¨å®Œæˆ
- âœ… **å®‰å…¨ä¿è¯**: é€šè¿‡å¤šç­¾é˜ˆå€¼å’Œ Timelock å»¶è¿Ÿé˜²æ­¢å•ç‚¹æ§åˆ¶

### å…³é”®ä¼˜åŠ¿

1. **ä»£ç ç®€æ´**: Aave å±‚é¢é€»è¾‘ç®€å•ï¼Œåªéœ€éªŒè¯åœ°å€
2. **å®é™…å»ä¸­å¿ƒåŒ–**: é€šè¿‡åˆçº¦åµŒå¥—å®ç°å¤šäººæ§åˆ¶
3. **çµæ´»é…ç½®**: æ”¯æŒä¸åŒå±‚çº§ä½¿ç”¨ä¸åŒçš„å¤šç­¾é…ç½®
4. **å®‰å…¨å¯é **: ç¬¦åˆä¸‰åŸåˆ™ï¼ˆæ˜¾æ€§æˆæƒã€èŒè´£åˆ†ç¦»ã€æœ€å°æƒé™ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸‰å±‚æƒé™æ¶æ„å®ç°æ–¹æ¡ˆ](../../.cursor/plans/ä¸‰å±‚æƒé™æ¶æ„å®ç°æ–¹æ¡ˆ_f59ab154.plan.md)
- [AAVEä»£ç ä¿®æ”¹ä¼˜å…ˆçº§æŒ‡å—](./AAVEä»£ç ä¿®æ”¹ä¼˜å…ˆçº§æŒ‡å—.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md)

---

## ğŸ”— å‚è€ƒèµ„æº

- [Gnosis Safe æ–‡æ¡£](https://docs.safe.global/)
- [OpenZeppelin AccessControl](https://docs.openzeppelin.com/contracts/4.x/access-control)
- [OpenZeppelin TimelockController](https://docs.openzeppelin.com/contracts/4.x/api/governance#TimelockController)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024  
**ä½œè€…**: Aave å¼€å‘å›¢é˜Ÿ

