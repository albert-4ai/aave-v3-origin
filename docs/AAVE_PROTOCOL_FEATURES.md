# Aave åè®®åŠŸèƒ½è¯¦è§£ - äº§å“è§†è§’åˆ†æ

> æœ¬æ–‡æ¡£ä»äº§å“è§’åº¦å…¨é¢åˆ†æ Aave V3 åè®®çš„æ ¸å¿ƒåŠŸèƒ½ã€ä½¿ç”¨åœºæ™¯å’Œå•†ä¸šä»·å€¼ã€‚

---

## ğŸ¦ åè®®å®šä½

Aave æ˜¯ä¸€ä¸ª**å»ä¸­å¿ƒåŒ–å€Ÿè´·åè®®**ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**é“¾ä¸Šé“¶è¡Œ**ï¼Œä½†æ¯”ä¼ ç»Ÿé“¶è¡Œæ›´é«˜æ•ˆï¼š
- **æ— éœ€è®¸å¯**ï¼šä»»ä½•äººéƒ½å¯ä»¥å­˜æ¬¾/å€Ÿæ¬¾ï¼Œæ— éœ€ KYC
- **å…¨çƒæ€§**ï¼š24/7 è¿è¡Œï¼Œæ— åœ°åŸŸé™åˆ¶
- **é€æ˜æ€§**ï¼šæ‰€æœ‰äº¤æ˜“å’Œåˆ©ç‡éƒ½åœ¨é“¾ä¸Šå¯æŸ¥
- **èµ„é‡‘æ•ˆç‡**ï¼šé€šè¿‡ç®—æ³•åŠ¨æ€è°ƒæ•´åˆ©ç‡

---

## ğŸ“Š æ ¸å¿ƒåŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½ç±»åˆ« | åŠŸèƒ½åç§° | ç›®æ ‡ç”¨æˆ· | æ ¸å¿ƒä»·å€¼ |
|---------|---------|---------|---------|
| ğŸ’° å­˜æ¬¾ | Supply | æŒå¸è€… | è·å–è¢«åŠ¨æ”¶ç›Š |
| ğŸ’³ å€Ÿè´· | Borrow/Repay | éœ€è¦æµåŠ¨æ€§è€… | ä¿æŒèµ„äº§æ•å£åŒæ—¶è·å–æµåŠ¨æ€§ |
| âš¡ é—ªç”µè´· | Flash Loan | å¼€å‘è€…/å¥—åˆ©è€… | æ— æŠµæŠ¼å•äº¤æ˜“å€Ÿè´· |
| ğŸ”¨ æ¸…ç®— | Liquidation | æ¸…ç®—æœºå™¨äºº | ç»´æŠ¤åè®®å¥åº·è·å–å¥–åŠ± |
| ğŸ¯ é«˜æ•ˆæ¨¡å¼ | eMode | é«˜çº§ç”¨æˆ· | ç›¸å…³èµ„äº§é«˜æ æ† |
| ğŸ“¦ æ‰“åŒ…æœåŠ¡ | StataToken | DeFi é›†æˆ | å¯ç»„åˆçš„æ”¶ç›Šä»£å¸ |

---

## 1ï¸âƒ£ Supplyï¼ˆå­˜æ¬¾ï¼‰ - èµšå–è¢«åŠ¨æ”¶ç›Š

### äº§å“æè¿°
ç”¨æˆ·å°†èµ„äº§å­˜å…¥åè®®ï¼Œè·å¾—ä»£è¡¨å­˜æ¬¾ä»½é¢çš„ **aToken**ï¼ˆå¦‚å­˜å…¥ USDC è·å¾— aUSDCï¼‰ã€‚

### å·¥ä½œåŸç†

```
ç”¨æˆ·å­˜å…¥ 1000 USDC
       â†“
åè®®é“¸é€  ~1000 aUSDC ç»™ç”¨æˆ·
       â†“
aUSDC ä½™é¢éšæ—¶é—´è‡ªåŠ¨å¢é•¿ï¼ˆåˆ©æ¯ç´¯ç§¯ï¼‰
       â†“
éšæ—¶å¯å–å› USDCï¼ˆæœ¬é‡‘ + åˆ©æ¯ï¼‰
```

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | ç”¨æˆ·ç”»åƒ | å…¸å‹è¡Œä¸º |
|-----|---------|---------|
| **ç¨³å®šæ”¶ç›Š** | é•¿æœŸæŒå¸è€… | å­˜å…¥ç¨³å®šå¸èµšå– 3-8% å¹´åŒ– |
| **æŒå¸ä¸å–** | ETH ä¿¡ä»°è€… | å­˜å…¥ ETH èµšåˆ©æ¯ï¼Œä¿æŒä»·æ ¼æ•å£ |
| **DeFi ç»„åˆ** | æ”¶ç›Šå†œæ°‘ | aToken å¯ç”¨äºå…¶ä»–åè®®å åŠ æ”¶ç›Š |

### äº§å“äº®ç‚¹
- âœ… **é›¶é”å®šæœŸ**ï¼šéšæ—¶å­˜å–ï¼Œæ— ä»»ä½•é™åˆ¶
- âœ… **è‡ªåŠ¨å¤åˆ©**ï¼šåˆ©æ¯è‡ªåŠ¨ç´¯ç§¯åˆ°æœ¬é‡‘
- âœ… **ä»£å¸åŒ–**ï¼šaToken å¯è½¬è´¦ã€äº¤æ˜“ã€ç”¨äºå…¶ä»– DeFi
- âœ… **é¦–æ¬¡å­˜æ¬¾è‡ªåŠ¨è®¾ä¸ºæŠµæŠ¼å“**ï¼šæ–¹ä¾¿åç»­å€Ÿæ¬¾

### åˆ©ç‡æœºåˆ¶
```
         åˆ©ç”¨ç‡ä½ â†’ ä½åˆ©ç‡ â†’ å¸å¼•å€Ÿæ¬¾äºº
                    â†“
         åˆ©ç”¨ç‡é«˜ â†’ é«˜åˆ©ç‡ â†’ å¸å¼•å­˜æ¬¾äºº
```
åˆ©ç‡ç”±**ä¾›éœ€å…³ç³»**é€šè¿‡ç®—æ³•åŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿å¸‚åœºå¹³è¡¡ã€‚

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `supply` - å­˜æ¬¾
```solidity
function supply(
    address asset,      // åº•å±‚èµ„äº§åœ°å€ï¼ˆå¦‚ USDCï¼‰
    uint256 amount,     // å­˜æ¬¾é‡‘é¢
    address onBehalfOf, // æ¥æ”¶ aToken çš„åœ°å€ï¼ˆå¯ä»£ä¸ºå­˜æ¬¾ï¼‰
    uint16 referralCode // æ¨èç ï¼ˆç”¨äºå¥–åŠ±è¿½è¸ªï¼Œæ— æ¨èå¡« 0ï¼‰
) external;
```
**åŠŸèƒ½**ï¼šå°†åº•å±‚èµ„äº§å­˜å…¥åè®®ï¼Œé“¸é€ ç­‰å€¼ aToken ç»™ `onBehalfOf` åœ°å€ã€‚

**ç¤ºä¾‹**ï¼š
```solidity
// å­˜å…¥ 1000 USDC åˆ°è‡ªå·±è´¦æˆ·
USDC.approve(address(pool), 1000e6);
pool.supply(address(USDC), 1000e6, msg.sender, 0);
```

#### `supplyWithPermit` - ç­¾åæˆæƒå­˜æ¬¾
```solidity
function supplyWithPermit(
    address asset,
    uint256 amount,
    address onBehalfOf,
    uint16 referralCode,
    uint256 deadline,   // ç­¾åè¿‡æœŸæ—¶é—´æˆ³
    uint8 permitV,      // ç­¾å V å€¼
    bytes32 permitR,    // ç­¾å R å€¼
    bytes32 permitS     // ç­¾å S å€¼
) external;
```
**åŠŸèƒ½**ï¼šä½¿ç”¨ EIP-2612 permit ç­¾åï¼Œä¸€ç¬”äº¤æ˜“å®Œæˆæˆæƒ+å­˜æ¬¾ï¼ŒèŠ‚çœ Gasã€‚

#### `withdraw` - å–æ¬¾
```solidity
function withdraw(
    address asset,   // è¦å–å›çš„åº•å±‚èµ„äº§
    uint256 amount,  // å–æ¬¾é‡‘é¢ï¼ˆä½¿ç”¨ type(uint256).max å–å›å…¨éƒ¨ï¼‰
    address to       // æ¥æ”¶åº•å±‚èµ„äº§çš„åœ°å€
) external returns (uint256); // è¿”å›å®é™…å–æ¬¾é‡‘é¢
```
**åŠŸèƒ½**ï¼šé”€æ¯ aTokenï¼Œå–å›ç­‰å€¼åº•å±‚èµ„äº§ã€‚

**ç¤ºä¾‹**ï¼š
```solidity
// å–å›å…¨éƒ¨ USDC
uint256 withdrawn = pool.withdraw(address(USDC), type(uint256).max, msg.sender);
```

#### `setUserUseReserveAsCollateral` - è®¾ç½®æŠµæŠ¼å“çŠ¶æ€
```solidity
function setUserUseReserveAsCollateral(
    address asset,        // èµ„äº§åœ°å€
    bool useAsCollateral  // true=ç”¨ä½œæŠµæŠ¼å“ï¼Œfalse=ä¸ç”¨
) external;
```
**åŠŸèƒ½**ï¼šæ§åˆ¶å­˜å…¥çš„èµ„äº§æ˜¯å¦ç”¨ä½œå€Ÿæ¬¾æŠµæŠ¼å“ã€‚

---

## 2ï¸âƒ£ Borrowï¼ˆå€Ÿæ¬¾ï¼‰ - æ æ†ä¸æµåŠ¨æ€§

### äº§å“æè¿°
ç”¨æˆ·ä»¥å­˜å…¥çš„èµ„äº§ä¸ºæŠµæŠ¼ï¼Œå€Ÿå‡ºå…¶ä»–èµ„äº§ï¼ŒåŒæ—¶ä¿æŒåŸèµ„äº§çš„ä»·æ ¼æ•å£ã€‚

### å·¥ä½œåŸç†

```
ç”¨æˆ·å·²å­˜å…¥ä»·å€¼ 10,000 ç¾å…ƒçš„ ETH
          â†“
æœ€é«˜å¯å€Ÿçº¦ 8,000 ç¾å…ƒçš„ç¨³å®šå¸ï¼ˆå–å†³äº LTVï¼‰
          â†“
åè®®é“¸é€ ç­‰å€¼å€ºåŠ¡ä»£å¸ï¼ˆVariable Debt Tokenï¼‰
          â†“
ç”¨æˆ·è·å¾—å€Ÿå‡ºçš„èµ„äº§ï¼Œæ‰¿æ‹…æµ®åŠ¨åˆ©æ¯
```

### å…³é”®å‚æ•°

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹ |
|-----|-----|-----|
| **LTV (Loan-to-Value)** | æœ€å¤§å€Ÿæ¬¾æ¯”ä¾‹ | ETH: 80%ï¼Œå³ 100 ç¾å…ƒ ETH æœ€å¤šå€Ÿ 80 ç¾å…ƒ |
| **æ¸…ç®—é˜ˆå€¼** | è§¦å‘æ¸…ç®—çš„å€ºåŠ¡æ¯”ä¾‹ | ETH: 82.5%ï¼Œè¶…è¿‡æ­¤å€¼å¯è¢«æ¸…ç®— |
| **å¥åº·å› å­** | ä»“ä½å®‰å…¨åº¦ | >1 å®‰å…¨ï¼Œ<1 å¯è¢«æ¸…ç®— |
| **æµ®åŠ¨åˆ©ç‡** | å€Ÿæ¬¾æˆæœ¬ | æ ¹æ®èµ„é‡‘åˆ©ç”¨ç‡åŠ¨æ€å˜åŒ– |

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | ç”¨æˆ·ç”»åƒ | å…¸å‹æ“ä½œ | é£é™©ç­‰çº§ |
|-----|---------|---------|---------|
| **æ æ†åšå¤š** | çœ‹æ¶¨äº¤æ˜“è€… | å­˜ ETH â†’ å€Ÿ USDC â†’ ä¹°æ›´å¤š ETH | âš ï¸ é«˜ |
| **ç¨åŠ¡ä¼˜åŒ–** | é•¿æœŸæŒæœ‰è€… | å­˜ BTC â†’ å€Ÿç¨³å®šå¸æ¶ˆè´¹ï¼Œé¿å…å–å‡ºè§¦å‘ç¨åŠ¡ | ä½ |
| **æµåŠ¨æ€§éœ€æ±‚** | èµ„äº§æŒæœ‰è€… | å­˜èµ„äº§å€Ÿæ¬¾åº”æ€¥ï¼Œä¿ç•™å‡å€¼æ½œåŠ› | ä¸­ |
| **ç©ºå¤´å¯¹å†²** | åšç©ºè€… | å­˜ç¨³å®šå¸ â†’ å€Ÿ ETH â†’ å–å‡º ETH | âš ï¸ é«˜ |

### äº§å“äº®ç‚¹
- âœ… **æ— è¿˜æ¬¾æœŸé™**ï¼šéšæ—¶è¿˜æ¬¾ï¼Œæ— å›ºå®šåˆ°æœŸæ—¥
- âœ… **æ— æœ€ä½å€Ÿæ¬¾**ï¼šçµæ´»å€Ÿæ¬¾é‡‘é¢
- âœ… **å¯ä»£ä¸ºè¿˜æ¬¾**ï¼šç¬¬ä¸‰æ–¹å¯å¸®ç”¨æˆ·è¿˜å€º
- âœ… **ç”¨ aToken è¿˜æ¬¾**ï¼šå¯ç›´æ¥ç”¨å­˜æ¬¾è¿˜å€º

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `borrow` - å€Ÿæ¬¾
```solidity
function borrow(
    address asset,            // è¦å€Ÿå‡ºçš„èµ„äº§åœ°å€
    uint256 amount,           // å€Ÿæ¬¾é‡‘é¢
    uint256 interestRateMode, // åˆ©ç‡æ¨¡å¼ï¼š2=æµ®åŠ¨åˆ©ç‡ï¼ˆ1=ç¨³å®šåˆ©ç‡å·²åºŸå¼ƒï¼‰
    uint16 referralCode,      // æ¨èç 
    address onBehalfOf        // æ‰¿æ‹…å€ºåŠ¡çš„åœ°å€ï¼ˆéœ€æœ‰ä¿¡ç”¨å§”æ‰˜æˆæƒï¼‰
) external;
```
**åŠŸèƒ½**ï¼šåŸºäºå·²å­˜å…¥çš„æŠµæŠ¼å“å€Ÿå‡ºèµ„äº§ã€‚

**å‰ç½®æ¡ä»¶**ï¼š
- å¿…é¡»æœ‰è¶³å¤Ÿçš„æŠµæŠ¼å“
- å€Ÿæ¬¾åå¥åº·å› å­å¿…é¡» > 1
- èµ„äº§å¿…é¡»å¯ç”¨å€Ÿæ¬¾åŠŸèƒ½

**ç¤ºä¾‹**ï¼š
```solidity
// å€Ÿå‡º 5000 USDCï¼ˆæµ®åŠ¨åˆ©ç‡ï¼‰
pool.borrow(address(USDC), 5000e6, 2, 0, msg.sender);
```

#### `repay` - è¿˜æ¬¾
```solidity
function repay(
    address asset,            // è¦è¿˜æ¬¾çš„èµ„äº§
    uint256 amount,           // è¿˜æ¬¾é‡‘é¢ï¼ˆtype(uint256).max è¿˜æ¸…å…¨éƒ¨å€ºåŠ¡ï¼‰
    uint256 interestRateMode, // åˆ©ç‡æ¨¡å¼ï¼š2=æµ®åŠ¨åˆ©ç‡
    address onBehalfOf        // è¢«è¿˜æ¬¾çš„å€Ÿæ¬¾äººåœ°å€
) external returns (uint256); // è¿”å›å®é™…è¿˜æ¬¾é‡‘é¢
```
**åŠŸèƒ½**ï¼šå¿è¿˜å€Ÿå‡ºçš„èµ„äº§ï¼Œé”€æ¯ç­‰å€¼å€ºåŠ¡ä»£å¸ã€‚

**ç¤ºä¾‹**ï¼š
```solidity
// å¸®ä»–äººè¿˜æ¸…å…¨éƒ¨ USDC å€ºåŠ¡
USDC.approve(address(pool), type(uint256).max);
pool.repay(address(USDC), type(uint256).max, 2, borrowerAddress);
```

#### `repayWithPermit` - ç­¾åæˆæƒè¿˜æ¬¾
```solidity
function repayWithPermit(
    address asset,
    uint256 amount,
    uint256 interestRateMode,
    address onBehalfOf,
    uint256 deadline,
    uint8 permitV,
    bytes32 permitR,
    bytes32 permitS
) external returns (uint256);
```
**åŠŸèƒ½**ï¼šä½¿ç”¨ EIP-2612 ç­¾åä¸€ç¬”äº¤æ˜“å®Œæˆæˆæƒ+è¿˜æ¬¾ã€‚

#### `repayWithATokens` - ç”¨ aToken è¿˜æ¬¾
```solidity
function repayWithATokens(
    address asset,            // èµ„äº§åœ°å€
    uint256 amount,           // è¿˜æ¬¾é‡‘é¢
    uint256 interestRateMode  // åˆ©ç‡æ¨¡å¼ï¼ˆV3.2 åæ­¤å‚æ•°å·²åºŸå¼ƒï¼‰
) external returns (uint256);
```
**åŠŸèƒ½**ï¼šç›´æ¥ç”¨ aToken è¿˜æ¬¾ï¼Œé€‚åˆåŒæ—¶æŒæœ‰å­˜æ¬¾å’Œå€Ÿæ¬¾çš„ç”¨æˆ·ã€‚

**ä¼˜åŠ¿**ï¼šæ— éœ€å…ˆå–æ¬¾å†è¿˜æ¬¾ï¼ŒèŠ‚çœ Gas å’Œæ“ä½œæ­¥éª¤ã€‚

**ç¤ºä¾‹**ï¼š
```solidity
// ç”¨ aUSDC è¿˜ USDC å€ºåŠ¡
pool.repayWithATokens(address(USDC), 1000e6, 2);
```

---

## 3ï¸âƒ£ Flash Loanï¼ˆé—ªç”µè´·ï¼‰ - åŸå­å¥—åˆ©ç¥å™¨

### äº§å“æè¿°
åœ¨**å•ç¬”äº¤æ˜“å†…**å€Ÿå‡ºä»»æ„é‡‘é¢ï¼Œåªè¦åœ¨äº¤æ˜“ç»“æŸå‰å½’è¿˜æœ¬é‡‘+æ‰‹ç»­è´¹ã€‚**æ— éœ€æŠµæŠ¼**ã€‚

### å·¥ä½œåŸç†

```
äº¤æ˜“å¼€å§‹
    â†“
ä» Aave å€Ÿå‡º 100ä¸‡ USDCï¼ˆæ— éœ€æŠµæŠ¼ï¼‰
    â†“
æ‰§è¡Œå¥—åˆ©/æ¸…ç®—/æŠµæŠ¼å“ç½®æ¢ç­‰æ“ä½œ
    â†“
å½’è¿˜ 100ä¸‡ + æ‰‹ç»­è´¹ï¼ˆçº¦ 0.05%ï¼‰
    â†“
äº¤æ˜“ç»“æŸ âœ…
    
ï¼ˆå¦‚æœæ— æ³•å½’è¿˜ï¼Œæ•´ç¬”äº¤æ˜“å›æ»šï¼Œä»¿ä½›ä»æœªå‘ç”Ÿï¼‰
```

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æè¿° | ç¤ºä¾‹ |
|-----|-----|-----|
| **DEX å¥—åˆ©** | åˆ©ç”¨ä¸åŒäº¤æ˜“æ‰€ä»·æ ¼å·®å¼‚ | A äº¤æ˜“æ‰€ ETH ä¾¿å®œï¼ŒB äº¤æ˜“æ‰€è´µ â†’ é—ªç”µè´·ä¹° A å– B |
| **æ¸…ç®—** | æ¸…ç®—ä»–äººä¸å¥åº·ä»“ä½ | å€Ÿèµ„é‡‘è¿˜å€º â†’ è·å¾—æŠµæŠ¼å“+å¥–åŠ± â†’ å–å‡ºè¿˜æ¬¾ |
| **æŠµæŠ¼å“ç½®æ¢** | ä¸€é”®æ¢æŠµæŠ¼èµ„äº§ | å°† USDC æŠµæŠ¼æ¢æˆ DAI æŠµæŠ¼ |
| **å€ºåŠ¡å†èèµ„** | ä»é«˜åˆ©ç‡è¿ç§»åˆ°ä½åˆ©ç‡ | å€Ÿæ¬¾è¿˜æ‰ A åè®®å€ºåŠ¡ â†’ åœ¨ B åè®®é‡æ–°å€Ÿ |
| **è‡ªæ¸…ç®—** | è§£é™¤å³å°†è¢«æ¸…ç®—çš„ä»“ä½ | å€Ÿæ¬¾è¿˜å€º â†’ å–å›æŠµæŠ¼å“ â†’ å–å‡ºè¿˜æ¬¾ |

### ä¸¤ç§æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | flashLoan | flashLoanSimple |
|-----|----------|-----------------|
| èµ„äº§æ•°é‡ | å¤šèµ„äº§ | å•èµ„äº§ |
| å¯è½¬ä¸ºå€ºåŠ¡ | âœ… æ˜¯ | âŒ å¦ |
| Gas æ¶ˆè€— | è¾ƒé«˜ | è¾ƒä½ |
| é€‚ç”¨åœºæ™¯ | å¤æ‚ç­–ç•¥ | ç®€å•å¥—åˆ© |

### æ‰‹ç»­è´¹
- æ™®é€šç”¨æˆ·ï¼š**0.05%**
- æˆæƒé—ªç”µè´·å€Ÿæ¬¾äººï¼š**0%**ï¼ˆéœ€è¦æ²»ç†æ‰¹å‡†ï¼‰

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `flashLoan` - å¤šèµ„äº§é—ªç”µè´·
```solidity
function flashLoan(
    address receiverAddress,       // æ¥æ”¶èµ„é‡‘çš„åˆçº¦ï¼ˆéœ€å®ç° IFlashLoanReceiverï¼‰
    address[] calldata assets,     // å€Ÿå‡ºçš„èµ„äº§æ•°ç»„
    uint256[] calldata amounts,    // å¯¹åº”çš„å€Ÿæ¬¾é‡‘é¢æ•°ç»„
    uint256[] calldata interestRateModes, // åˆ©ç‡æ¨¡å¼æ•°ç»„ï¼š
                                   //   0 = å¿…é¡»å½’è¿˜ï¼ˆæ ‡å‡†é—ªç”µè´·ï¼‰
                                   //   2 = ä¸å½’è¿˜ï¼Œè½¬ä¸ºæµ®åŠ¨åˆ©ç‡å€ºåŠ¡
    address onBehalfOf,            // å¦‚æœè½¬ä¸ºå€ºåŠ¡ï¼Œæ‰¿æ‹…å€ºåŠ¡çš„åœ°å€
    bytes calldata params,         // ä¼ é€’ç»™ receiver çš„è‡ªå®šä¹‰å‚æ•°
    uint16 referralCode            // æ¨èç 
) external;
```
**åŠŸèƒ½**ï¼šå•ç¬”äº¤æ˜“å†…å€Ÿå‡ºå¤šç§èµ„äº§ï¼Œå¯é€‰æ‹©å½’è¿˜æˆ–è½¬ä¸ºå€ºåŠ¡ã€‚

**æ¥æ”¶åˆçº¦å¿…é¡»å®ç°**ï¼š
```solidity
interface IFlashLoanReceiver {
    function executeOperation(
        address[] calldata assets,
        uint256[] calldata amounts,
        uint256[] calldata premiums,  // æ‰‹ç»­è´¹æ•°ç»„
        address initiator,
        bytes calldata params
    ) external returns (bool);
}
```

**ç¤ºä¾‹ï¼ˆå¥—åˆ©åˆçº¦ï¼‰**ï¼š
```solidity
// å‘èµ·é—ªç”µè´·
address[] memory assets = new address[](1);
assets[0] = address(USDC);
uint256[] memory amounts = new uint256[](1);
amounts[0] = 1000000e6; // 100ä¸‡ USDC
uint256[] memory modes = new uint256[](1);
modes[0] = 0; // å¿…é¡»å½’è¿˜

pool.flashLoan(
    address(this),  // æœ¬åˆçº¦æ¥æ”¶
    assets,
    amounts,
    modes,
    address(0),     // ä¸è½¬ä¸ºå€ºåŠ¡
    abi.encode(arbitrageParams),
    0
);
```

#### `flashLoanSimple` - å•èµ„äº§é—ªç”µè´·
```solidity
function flashLoanSimple(
    address receiverAddress, // æ¥æ”¶èµ„é‡‘çš„åˆçº¦
    address asset,           // å€Ÿå‡ºçš„èµ„äº§
    uint256 amount,          // å€Ÿæ¬¾é‡‘é¢
    bytes calldata params,   // è‡ªå®šä¹‰å‚æ•°
    uint16 referralCode      // æ¨èç 
) external;
```
**åŠŸèƒ½**ï¼šç®€åŒ–ç‰ˆé—ªç”µè´·ï¼Œä»…æ”¯æŒå•èµ„äº§ï¼ŒGas æ›´ä½ã€‚

**æ¥æ”¶åˆçº¦å¿…é¡»å®ç°**ï¼š
```solidity
interface IFlashLoanSimpleReceiver {
    function executeOperation(
        address asset,
        uint256 amount,
        uint256 premium,
        address initiator,
        bytes calldata params
    ) external returns (bool);
}
```

**æ‰‹ç»­è´¹è®¡ç®—**ï¼š
```solidity
// éœ€è¦å½’è¿˜çš„æ€»é‡‘é¢
uint256 amountOwed = amount + (amount * FLASHLOAN_PREMIUM_TOTAL / 10000);
// å¦‚ FLASHLOAN_PREMIUM_TOTAL = 5ï¼Œåˆ™æ‰‹ç»­è´¹ = 0.05%
```

---

## 4ï¸âƒ£ Liquidationï¼ˆæ¸…ç®—ï¼‰ - ç»´æŠ¤åè®®å¥åº·

### äº§å“æè¿°
å½“å€Ÿæ¬¾äººçš„**å¥åº·å› å­ < 1** æ—¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä»£ä¸ºå¿è¿˜éƒ¨åˆ†å€ºåŠ¡ï¼Œå¹¶è·å¾—ç­‰å€¼æŠµæŠ¼å“ + **æ¸…ç®—å¥–åŠ±**ã€‚

### å·¥ä½œåŸç†

```
å€Ÿæ¬¾äººå¥åº·å› å­é™è‡³ 0.9
         â†“
æ¸…ç®—äººå‘ç°æœºä¼šï¼Œè°ƒç”¨ liquidationCall()
         â†“
æ¸…ç®—äººå¿è¿˜å€Ÿæ¬¾äººéƒ¨åˆ†/å…¨éƒ¨å€ºåŠ¡
         â†“
æ¸…ç®—äººè·å¾—ç­‰å€¼æŠµæŠ¼å“ + 5-10% æ¸…ç®—å¥–åŠ±
         â†“
å€Ÿæ¬¾äººä»“ä½å¥åº·å› å­æ¢å¤
```

### V3.3 æ¸…ç®—ä¼˜åŒ–

| ä¼˜åŒ– | æ—§ç‰ˆè¡Œä¸º | æ–°ç‰ˆè¡Œä¸º |
|-----|---------|---------|
| **å…³é—­å› å­** | æ¯ä¸ªèµ„äº§æœ€å¤šæ¸…ç®— 50% | æ•´ä¸ªä»“ä½æœ€å¤š 50%ï¼Œå°ä»“ä½å¯ 100% |
| **å°ä»“ä½å¤„ç†** | å¯èƒ½ç•™ä¸‹ç²‰å°˜ä»“ä½ | ä½äº 2000 ç¾å…ƒå¯å…¨é¢æ¸…ç®— |
| **å¼ºåˆ¶æ¸…ä»“** | å¯ç•™ä»»æ„ç²‰å°˜ | ä¸å…è®¸ç•™ä¸‹ä½äº 1000 ç¾å…ƒçš„æ®‹ä½™ |
| **åè´¦å¤„ç†** | æ— è‡ªåŠ¨å¤„ç† | é›¶æŠµæŠ¼ä»“ä½çš„å€ºåŠ¡è‡ªåŠ¨é”€æ¯å¹¶è®°ä¸ºèµ¤å­— |

### æ¸…ç®—ç»æµå­¦

```
å‡è®¾ï¼š
- å€Ÿæ¬¾äººæœ‰ä»·å€¼ 1000 ç¾å…ƒçš„ ETH æŠµæŠ¼
- å€Ÿæ¬¾äººæ¬  900 ç¾å…ƒ USDC
- å¥åº·å› å­é™è‡³ 0.95ï¼ˆå¯è¢«æ¸…ç®—ï¼‰
- æ¸…ç®—å¥–åŠ± 5%

æ¸…ç®—äººæ“ä½œï¼š
- æ”¯ä»˜ 450 USDCï¼ˆæ¸…ç®— 50% å€ºåŠ¡ï¼‰
- è·å¾— 472.5 ç¾å…ƒçš„ ETHï¼ˆ450 * 1.05ï¼‰
- å‡€åˆ©æ¶¦ï¼š22.5 ç¾å…ƒ
```

### å…³é”®å¸¸é‡
- `DEFAULT_LIQUIDATION_CLOSE_FACTOR`: 50%ï¼ˆé»˜è®¤æ¸…ç®—æ¯”ä¾‹ï¼‰
- `CLOSE_FACTOR_HF_THRESHOLD`: 0.95ï¼ˆå¥åº·å› å­ä½äºæ­¤å€¼å¯ 100% æ¸…ç®—ï¼‰
- `MIN_BASE_MAX_CLOSE_FACTOR_THRESHOLD`: 2000 USDï¼ˆä½äºæ­¤å€¼å¯ 100% æ¸…ç®—ï¼‰
- `MIN_LEFTOVER_BASE`: 1000 USDï¼ˆæ¸…ç®—åæœ€ä½æ®‹ä½™å€¼ï¼‰

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `liquidationCall` - æ‰§è¡Œæ¸…ç®—
```solidity
function liquidationCall(
    address collateralAsset, // è¦è·å–çš„æŠµæŠ¼å“èµ„äº§
    address debtAsset,       // è¦å¿è¿˜çš„å€ºåŠ¡èµ„äº§
    address borrower,        // è¢«æ¸…ç®—çš„å€Ÿæ¬¾äººåœ°å€
    uint256 debtToCover,     // è¦å¿è¿˜çš„å€ºåŠ¡é‡‘é¢ï¼ˆä½¿ç”¨ type(uint256).max æ¸…ç®—æœ€å¤§å…è®¸é‡‘é¢ï¼‰
    bool receiveAToken       // true=è·å¾— aTokenï¼Œfalse=è·å¾—åº•å±‚èµ„äº§
) external;
```
**åŠŸèƒ½**ï¼šæ¸…ç®—å¥åº·å› å­ < 1 çš„ä»“ä½ï¼Œè·å¾—æŠµæŠ¼å“ + æ¸…ç®—å¥–åŠ±ã€‚

**å‰ç½®æ¡ä»¶**ï¼š
- å€Ÿæ¬¾äººå¥åº·å› å­ < 1
- æ¸…ç®—äººæœ‰è¶³å¤Ÿèµ„é‡‘å¿è¿˜å€ºåŠ¡
- æŠµæŠ¼èµ„äº§å’Œå€ºåŠ¡èµ„äº§éƒ½å·²å¯ç”¨æ¸…ç®—

**æ¸…ç®—é‡‘é¢é™åˆ¶**ï¼ˆV3.3ï¼‰ï¼š
```solidity
// å…³é—­å› å­è§„åˆ™
if (healthFactor < 0.95e18) {
    // å¯æ¸…ç®— 100%
} else if (totalDebt < MIN_BASE_MAX_CLOSE_FACTOR_THRESHOLD) {
    // å°ä»“ä½ï¼ˆ<2000 USDï¼‰å¯æ¸…ç®— 100%
} else {
    // é»˜è®¤åªèƒ½æ¸…ç®— 50%
}
```

**ç¤ºä¾‹ï¼ˆä½¿ç”¨é—ªç”µè´·æ¸…ç®—ï¼‰**ï¼š
```solidity
function executeOperation(...) external returns (bool) {
    // 1. æ”¶åˆ°é—ªç”µè´·èµ„é‡‘
    
    // 2. æ‰§è¡Œæ¸…ç®—
    IERC20(debtAsset).approve(address(pool), debtAmount);
    pool.liquidationCall(
        collateralAsset,
        debtAsset,
        borrower,
        debtAmount,
        false  // è·å¾—åº•å±‚èµ„äº§ä»¥ä¾¿å–å‡º
    );
    
    // 3. å–å‡ºè·å¾—çš„æŠµæŠ¼å“
    uint256 collateralReceived = IERC20(collateralAsset).balanceOf(address(this));
    // ... åœ¨ DEX å–å‡º ...
    
    // 4. å½’è¿˜é—ªç”µè´· + æ‰‹ç»­è´¹
    return true;
}
```

#### `getUserAccountData` - æŸ¥è¯¢ç”¨æˆ·è´¦æˆ·æ•°æ®ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦å¯æ¸…ç®—ï¼‰
```solidity
function getUserAccountData(address user) external view returns (
    uint256 totalCollateralBase,       // æ€»æŠµæŠ¼å“ä»·å€¼ï¼ˆåŸºç¡€è´§å¸ï¼‰
    uint256 totalDebtBase,             // æ€»å€ºåŠ¡ä»·å€¼ï¼ˆåŸºç¡€è´§å¸ï¼‰
    uint256 availableBorrowsBase,      // å¯å€Ÿé¢åº¦
    uint256 currentLiquidationThreshold, // å½“å‰æ¸…ç®—é˜ˆå€¼
    uint256 ltv,                       // å½“å‰ LTV
    uint256 healthFactor               // å¥åº·å› å­ï¼ˆ< 1e18 å¯è¢«æ¸…ç®—ï¼‰
);
```

---

## 5ï¸âƒ£ eModeï¼ˆé«˜æ•ˆæ¨¡å¼ï¼‰ - ç›¸å…³èµ„äº§é«˜æ æ†

### äº§å“æè¿°
å…è®¸ç›¸å…³æ€§é«˜çš„èµ„äº§ï¼ˆå¦‚ä¸åŒç¨³å®šå¸ã€ä¸åŒ ETH è¡ç”Ÿå“ï¼‰äº«å—æ›´é«˜çš„å€Ÿè´·æ¯”ç‡ã€‚

### æ ¸å¿ƒæ¦‚å¿µ

```
æ™®é€šæ¨¡å¼ï¼šETH æŠµæŠ¼ï¼ŒLTV 80%
                â†“
  eModeï¼ˆETH ç±»åˆ«ï¼‰ï¼šstETH/wstETH/ETH äº’å€Ÿ
                â†“
            LTV å¯è¾¾ 93%
```

### V3.2 Liquid eMode ç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|-----|-----|
| **å¤šç±»åˆ«æ”¯æŒ** | åŒä¸€èµ„äº§å¯å±äºå¤šä¸ª eMode |
| **å€Ÿè´·åˆ†ç¦»é…ç½®** | å¯è®¾ç½®èµ„äº§ä»…å¯å€Ÿå‡º/ä»…å¯æŠµæŠ¼/ä¸¤è€…çš†å¯ |
| **çµæ´»åˆ‡æ¢** | åªè¦å¥åº·å› å­ â‰¥ 1ï¼Œå¯éšæ—¶åˆ‡æ¢ eMode |

### å…¸å‹ eMode é…ç½®

| eMode ç±»åˆ« | åŒ…å«èµ„äº§ | å…¸å‹ LTV | ä½¿ç”¨åœºæ™¯ |
|-----------|---------|---------|---------|
| ç¨³å®šå¸ | USDC, USDT, DAI | 97% | ç¨³å®šå¸äº’æ¢æ æ† |
| ETH ç›¸å…³ | ETH, stETH, wstETH, weETH | 93% | LST æ æ†æŒ–çŸ¿ |
| BTC ç›¸å…³ | WBTC, cbBTC | 90% | BTC è¡ç”Ÿå“å¥—åˆ© |

### eMode è§„åˆ™
- eMode = 0 æ˜¯ç‰¹æ®Šæƒ…å†µï¼Œè¡¨ç¤º"æ—  eMode"
- è¿›å…¥ eMode ååªèƒ½å€Ÿè¯¥ eMode ä¸­å¯å€Ÿçš„èµ„äº§
- é eMode èµ„äº§ä»å¯ä½œä¸ºæŠµæŠ¼å“ï¼Œä½†ä½¿ç”¨å…¶æ™®é€š LTV
- èµ„äº§å¿…é¡»åŒæ—¶åœ¨ eMode å¤–å¯å€Ÿ/å¯æŠµæŠ¼ï¼Œæ‰èƒ½åœ¨ eMode å†…å¯ç”¨

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `setUserEMode` - è®¾ç½®ç”¨æˆ· eMode
```solidity
function setUserEMode(uint8 categoryId) external;
```
**åŠŸèƒ½**ï¼šè®©ç”¨æˆ·è¿›å…¥æˆ–é€€å‡ºæŸä¸ª eMode ç±»åˆ«ã€‚

**å‚æ•°**ï¼š
- `categoryId = 0`ï¼šé€€å‡º eModeï¼Œä½¿ç”¨æ™®é€šæ¨¡å¼
- `categoryId > 0`ï¼šè¿›å…¥å¯¹åº”çš„ eMode ç±»åˆ«

**å‰ç½®æ¡ä»¶**ï¼š
- åˆ‡æ¢åå¥åº·å› å­å¿…é¡» â‰¥ 1
- å½“å‰å€Ÿæ¬¾çš„èµ„äº§å¿…é¡»åœ¨ç›®æ ‡ eMode ä¸­å¯å€Ÿ

**ç¤ºä¾‹**ï¼š
```solidity
// è¿›å…¥ç¨³å®šå¸ eModeï¼ˆå‡è®¾ categoryId = 1ï¼‰
pool.setUserEMode(1);

// é€€å‡º eMode
pool.setUserEMode(0);
```

#### `getUserEMode` - è·å–ç”¨æˆ·å½“å‰ eMode
```solidity
function getUserEMode(address user) external view returns (uint256);
```

#### `getEModeCategoryCollateralConfig` - è·å– eMode æŠµæŠ¼é…ç½®
```solidity
function getEModeCategoryCollateralConfig(uint8 id) 
    external view returns (DataTypes.CollateralConfig memory);

// CollateralConfig ç»“æ„
struct CollateralConfig {
    uint16 ltv;                  // LTV (bps, å¦‚ 9700 = 97%)
    uint16 liquidationThreshold; // æ¸…ç®—é˜ˆå€¼
    uint16 liquidationBonus;     // æ¸…ç®—å¥–åŠ±
}
```

#### `getEModeCategoryLabel` - è·å– eMode æ ‡ç­¾
```solidity
function getEModeCategoryLabel(uint8 id) external view returns (string memory);
// è¿”å›å¦‚ "Stablecoins", "ETH correlated" ç­‰
```

#### `getEModeCategoryCollateralBitmap` - è·å– eMode æŠµæŠ¼å“ä½å›¾
```solidity
function getEModeCategoryCollateralBitmap(uint8 id) external view returns (uint128);
// ä½å›¾ä¸­ä¸º 1 çš„ä½ç½®å¯¹åº”çš„èµ„äº§å¯ä½œä¸ºè¯¥ eMode çš„æŠµæŠ¼å“
```

#### `getEModeCategoryBorrowableBitmap` - è·å– eMode å¯å€Ÿä½å›¾
```solidity
function getEModeCategoryBorrowableBitmap(uint8 id) external view returns (uint128);
// ä½å›¾ä¸­ä¸º 1 çš„ä½ç½®å¯¹åº”çš„èµ„äº§å¯åœ¨è¯¥ eMode ä¸­å€Ÿå‡º
```

---

## 6ï¸âƒ£ Isolation Modeï¼ˆéš”ç¦»æ¨¡å¼ï¼‰ - é£é™©éš”ç¦»

### äº§å“æè¿°
æ–°ä¸Šæ¶çš„é«˜é£é™©èµ„äº§åªèƒ½ä½œä¸º**å”¯ä¸€æŠµæŠ¼å“**ï¼Œä¸”æœ‰**å€ºåŠ¡ä¸Šé™**ï¼Œä¿æŠ¤åè®®å…å—å•ä¸€èµ„äº§é£é™©ã€‚

### å·¥ä½œåŸç†

```
ç”¨æˆ·å­˜å…¥éš”ç¦»èµ„äº§ï¼ˆå¦‚æ–°ä¸Šæ¶çš„ XYZ ä»£å¸ï¼‰
              â†“
åªèƒ½å€Ÿç¨³å®šå¸ï¼Œä¸èƒ½å€Ÿå…¶ä»–èµ„äº§
              â†“
æ•´ä¸ªåè®®å¯¹è¯¥èµ„äº§çš„æ€»å€ºåŠ¡æœ‰ä¸Šé™
              â†“
å¦‚æœè¦ç”¨å…¶ä»–æŠµæŠ¼å“ï¼Œå¿…é¡»å…ˆå–å‡ºéš”ç¦»èµ„äº§
```

### äº§å“ä»·å€¼
- ğŸ›¡ï¸ å…è®¸ä¸Šæ¶æ–°èµ„äº§è€Œä¸å±åŠæ•´ä¸ªåè®®
- ğŸ“Š é€æ­¥å»ºç«‹èµ„äº§ä¿¡ç”¨åº¦
- ğŸ”’ é™åˆ¶å•ä¸€èµ„äº§é€ æˆçš„æœ€å¤§æŸå¤±

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `resetIsolationModeTotalDebt` - é‡ç½®éš”ç¦»æ¨¡å¼æ€»å€ºåŠ¡
```solidity
function resetIsolationModeTotalDebt(address asset) external;
```
**åŠŸèƒ½**ï¼šå°†éš”ç¦»èµ„äº§çš„æ€»å€ºåŠ¡è®¡æ•°å™¨é‡ç½®ä¸º 0ã€‚

**å‰ç½®æ¡ä»¶**ï¼š
- èµ„äº§çš„å€ºåŠ¡ä¸Šé™ï¼ˆdebt ceilingï¼‰å¿…é¡»å·²è®¾ä¸º 0
- ä»… PoolConfigurator å¯è°ƒç”¨

**ä½¿ç”¨åœºæ™¯**ï¼šå½“è¦å–æ¶ˆèµ„äº§çš„éš”ç¦»æ¨¡å¼çŠ¶æ€æ—¶ä½¿ç”¨ã€‚

---

## 7ï¸âƒ£ Position Managerï¼ˆä»“ä½ç®¡ç†å™¨ï¼‰ - è‡ªåŠ¨åŒ–æ“ä½œ

### äº§å“æè¿°ï¼ˆV3.4 æ–°å¢ï¼‰
ç”¨æˆ·å¯æˆæƒç¬¬ä¸‰æ–¹æ™ºèƒ½åˆçº¦ä»£ä¸ºç®¡ç†ä»“ä½çš„ç‰¹å®šæ“ä½œã€‚

### æˆæƒèŒƒå›´
- âœ… è®¾ç½®èµ„äº§æ˜¯å¦ç”¨ä½œæŠµæŠ¼å“
- âœ… åˆ‡æ¢ eMode
- âŒ ä¸èƒ½å­˜æ¬¾/å–æ¬¾/å€Ÿæ¬¾/è¿˜æ¬¾

### ä½¿ç”¨åœºæ™¯
- **è‡ªåŠ¨åŒ–ä»“ä½è°ƒæ•´**ï¼šå¦‚è‡ªåŠ¨å»æ æ†ç­–ç•¥
- **DAO ç®¡ç†**ï¼šå¤šç­¾åˆçº¦ç®¡ç†åè®®ä»“ä½
- **DeFi ç»„åˆ**ï¼šå…¶ä»–åè®®ä»£ä¸ºè°ƒæ•´ Aave ä»“ä½

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `approvePositionManager` - æˆæƒä»“ä½ç®¡ç†å™¨
```solidity
function approvePositionManager(
    address positionManager, // ä»“ä½ç®¡ç†å™¨åˆçº¦åœ°å€
    bool approve             // true=æˆæƒï¼Œfalse=å–æ¶ˆæˆæƒ
) external;
```
**åŠŸèƒ½**ï¼šæˆæƒç¬¬ä¸‰æ–¹åˆçº¦ä»£ä¸ºç®¡ç†ä»“ä½çš„æŠµæŠ¼å“è®¾ç½®å’Œ eModeã€‚

**äº‹ä»¶**ï¼š
```solidity
event PositionManagerApproved(address indexed user, address indexed positionManager);
event PositionManagerRevoked(address indexed user, address indexed positionManager);
```

**ç¤ºä¾‹**ï¼š
```solidity
// æˆæƒè‡ªåŠ¨åŒ–ç­–ç•¥åˆçº¦
pool.approvePositionManager(address(autoStrategy), true);
```

#### `renouncePositionManagerRole` - æ”¾å¼ƒä»“ä½ç®¡ç†å™¨è§’è‰²
```solidity
function renouncePositionManagerRole(address user) external;
```
**åŠŸèƒ½**ï¼šä»“ä½ç®¡ç†å™¨ä¸»åŠ¨æ”¾å¼ƒå¯¹æŸç”¨æˆ·ä»“ä½çš„ç®¡ç†æƒé™ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼šç­–ç•¥åˆçº¦å®Œæˆä»»åŠ¡åä¸»åŠ¨æ”¾å¼ƒæƒé™ï¼Œå¢å¼ºå®‰å…¨æ€§ã€‚

#### `setUserUseReserveAsCollateralOnBehalfOf` - ä»£ä¸ºè®¾ç½®æŠµæŠ¼å“
```solidity
function setUserUseReserveAsCollateralOnBehalfOf(
    address asset,         // èµ„äº§åœ°å€
    bool useAsCollateral,  // æ˜¯å¦ç”¨ä½œæŠµæŠ¼å“
    address onBehalfOf     // ç”¨æˆ·åœ°å€
) external;
```
**åŠŸèƒ½**ï¼šå·²æˆæƒçš„ä»“ä½ç®¡ç†å™¨ä»£ä¸ºè®¾ç½®ç”¨æˆ·çš„æŠµæŠ¼å“çŠ¶æ€ã€‚

**æƒé™**ï¼šä»…å·²æˆæƒçš„ä»“ä½ç®¡ç†å™¨å¯è°ƒç”¨ã€‚

#### `setUserEModeOnBehalfOf` - ä»£ä¸ºè®¾ç½® eMode
```solidity
function setUserEModeOnBehalfOf(
    uint8 categoryId,   // eMode ç±»åˆ« ID
    address onBehalfOf  // ç”¨æˆ·åœ°å€
) external;
```
**åŠŸèƒ½**ï¼šå·²æˆæƒçš„ä»“ä½ç®¡ç†å™¨ä»£ä¸ºåˆ‡æ¢ç”¨æˆ·çš„ eModeã€‚

#### `isApprovedPositionManager` - æ£€æŸ¥æˆæƒçŠ¶æ€
```solidity
function isApprovedPositionManager(
    address user,
    address positionManager
) external view returns (bool);
```

---

## 8ï¸âƒ£ StataToken - DeFi å¯ç»„åˆæ€§

### äº§å“æè¿°
å°† **aToken åŒ…è£…**æˆç¬¦åˆ ERC-4626 æ ‡å‡†çš„æ”¶ç›Šä»£å¸ï¼Œæ–¹ä¾¿ä¸å…¶ä»– DeFi åè®®é›†æˆã€‚

### aToken vs StataToken

| ç‰¹æ€§ | aToken | StataToken |
|-----|--------|------------|
| ä½™é¢å˜åŒ– | éšæ—¶é—´å¢é•¿ | å›ºå®šä¸å˜ |
| ä»·å€¼å˜åŒ– | å›ºå®š 1:1 åº•å±‚èµ„äº§ | éšæ—¶é—´å¢é•¿ |
| æ ‡å‡†å…¼å®¹ | éæ ‡å‡† ERC20 | ERC-4626 |
| DeFi å…¼å®¹æ€§ | éœ€è¦ç‰¹æ®Šå¤„ç† | å¼€ç®±å³ç”¨ |

### æ ¸å¿ƒåŠŸèƒ½
- âœ… å®Œæ•´ ERC-4626 å…¼å®¹
- âœ… ä¿ç•™æµåŠ¨æ€§æŒ–çŸ¿å¥–åŠ±
- âœ… å¯è¢« Aave æ²»ç†å‡çº§
- âœ… å·¥å‚åˆçº¦ä¸€é”®éƒ¨ç½²
- âœ… æä¾› `latestAnswer` ä»·æ ¼é¢„è¨€æœºæ¥å£

### ä½¿ç”¨åœºæ™¯
- **LP æ± **ï¼šä½œä¸ºç¨³å®šå¸å¯¹çš„ä¸€æ–¹
- **æŠµæŠ¼å“**ï¼šå…¶ä»–å€Ÿè´·åè®®çš„æŠµæŠ¼å“
- **æ”¶ç›Šèšåˆå™¨**ï¼šYearn ç­‰ç­–ç•¥çš„åº•å±‚èµ„äº§

### å®‰å…¨ç‰¹æ€§
- å¯æš‚åœï¼ˆç´§æ€¥æƒ…å†µä¸‹åœæ­¢æ‰€æœ‰æ“ä½œï¼‰
- å¯æ•‘æ´ï¼ˆç®¡ç†å‘˜å¯å–å›è¯¯å‘é€çš„ä»£å¸ï¼‰
- åŸºäº OpenZeppelin å¯å‡çº§åˆçº¦

---

## 9ï¸âƒ£ èµ¤å­—ç®¡ç†ï¼ˆDeficit Managementï¼‰- åè´¦å¤„ç†

### äº§å“æè¿°ï¼ˆV3.3 æ–°å¢ï¼‰
å½“æ¸…ç®—æ— æ³•å®Œå…¨è¦†ç›–å€ºåŠ¡æ—¶ï¼Œäº§ç”Ÿçš„åè´¦ï¼ˆèµ¤å­—ï¼‰è¢«åè®®è¿½è¸ªï¼Œå¯ç”±æˆæƒå®ä½“ï¼ˆUmbrellaï¼‰è¦†ç›–ã€‚

### å·¥ä½œæµç¨‹

```
æ¸…ç®—åå€Ÿæ¬¾äººä»æœ‰å€ºåŠ¡ï¼Œä½†æ— æŠµæŠ¼å“
            â†“
ç³»ç»Ÿè‡ªåŠ¨é”€æ¯å€ºåŠ¡ä»£å¸ï¼Œè®°å½•ä¸ºèµ¤å­—
            â†“
Umbrella åˆçº¦ï¼ˆä¿é™©æœºåˆ¶ï¼‰é€šè¿‡é”€æ¯ aToken è¦†ç›–èµ¤å­—
            â†“
å‚¨å¤‡æ¢å¤å¥åº·
```

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### `eliminateReserveDeficit` - è¦†ç›–å‚¨å¤‡èµ¤å­—
```solidity
function eliminateReserveDeficit(
    address asset,   // æœ‰èµ¤å­—çš„èµ„äº§
    uint256 amount   // è¦è¦†ç›–çš„é‡‘é¢ï¼ˆä»¥ aToken è®¡ï¼‰
) external returns (uint256); // è¿”å›å®é™…è¦†ç›–çš„é‡‘é¢
```
**åŠŸèƒ½**ï¼šé€šè¿‡é”€æ¯ aToken æ¥è¦†ç›–å‚¨å¤‡çš„åè´¦èµ¤å­—ã€‚

**æƒé™**ï¼šä»… Umbrella åˆçº¦å¯è°ƒç”¨ã€‚

**å‰ç½®æ¡ä»¶**ï¼š
- è°ƒç”¨è€…ä¸èƒ½æœ‰ä»»ä½•å€Ÿæ¬¾
- å‚¨å¤‡å¿…é¡»å­˜åœ¨èµ¤å­—
- è°ƒç”¨è€…å¿…é¡»æœ‰è¶³å¤Ÿçš„ aToken

**å·¥ä½œåŸç†**ï¼š
```solidity
// 1. æ£€æŸ¥å½“å‰èµ¤å­—
uint256 deficit = pool.getReserveDeficit(asset);

// 2. è¦†ç›–èµ¤å­—ï¼ˆé”€æ¯ aTokenï¼‰
uint256 covered = pool.eliminateReserveDeficit(asset, amount);

// 3. èµ¤å­—å‡å°‘ï¼Œå‚¨å¤‡æ¢å¤å¥åº·
```

#### `getReserveDeficit` - è·å–å‚¨å¤‡èµ¤å­—
```solidity
function getReserveDeficit(address asset) external view returns (uint256);
```
**è¿”å›**ï¼šå‚¨å¤‡å½“å‰çš„åè´¦é‡‘é¢ã€‚

---

## ğŸ”§ åè®®æ²»ç†ä¸é…ç½®åŠŸèƒ½

### ç®¡ç†å‘˜åŠŸèƒ½æ¦‚è§ˆ

| åŠŸèƒ½ | æè¿° | æ‰§è¡Œè€… |
|-----|-----|-------|
| ä¸Šæ¶èµ„äº§ | æ·»åŠ æ–°çš„å¯å€Ÿè´·èµ„äº§ | PoolConfigurator |
| è°ƒæ•´å‚æ•° | ä¿®æ”¹ LTVã€æ¸…ç®—é˜ˆå€¼ç­‰ | Risk Admin |
| å†»ç»“èµ„äº§ | æš‚åœå­˜æ¬¾/å€Ÿæ¬¾ | Emergency Admin / Risk Admin |
| æš‚åœåè®® | å®Œå…¨æš‚åœæ‰€æœ‰æ“ä½œ | Emergency Admin |
| æ¸…ç®—å®½é™æœŸ | è®¾ç½®è§£é™¤æš‚åœåçš„æ¸…ç®—å»¶è¿Ÿ | Emergency Admin |

### æ ¸å¿ƒå‡½æ•°è¯¦è§£

#### Pool ç®¡ç†å‡½æ•°

```solidity
// åˆå§‹åŒ–å‚¨å¤‡ï¼ˆä»… PoolConfiguratorï¼‰
function initReserve(
    address asset,              // åº•å±‚èµ„äº§åœ°å€
    address aTokenAddress,      // aToken å®ç°åœ°å€
    address variableDebtAddress // å¯å˜å€ºåŠ¡ä»£å¸åœ°å€
) external;

// ç§»é™¤å‚¨å¤‡ï¼ˆä»… PoolConfiguratorï¼‰
function dropReserve(address asset) external;

// è®¾ç½®å‚¨å¤‡é…ç½®ä½å›¾ï¼ˆä»… PoolConfiguratorï¼‰
function setConfiguration(
    address asset,
    DataTypes.ReserveConfigurationMap calldata configuration
) external;

// åŒæ­¥æŒ‡æ•°çŠ¶æ€ï¼ˆä»… PoolConfiguratorï¼‰
function syncIndexesState(address asset) external;

// åŒæ­¥åˆ©ç‡çŠ¶æ€ï¼ˆä»… PoolConfiguratorï¼‰
function syncRatesState(address asset) external;
```

#### æ¸…ç®—å®½é™æœŸå‡½æ•°

```solidity
// è®¾ç½®æ¸…ç®—å®½é™æœŸï¼ˆä»… PoolConfiguratorï¼‰
function setLiquidationGracePeriod(
    address asset,  // èµ„äº§åœ°å€
    uint40 until    // å®½é™æœŸç»“æŸæ—¶é—´æˆ³ï¼ˆ0=ç¦ç”¨ï¼‰
) external;

// è·å–æ¸…ç®—å®½é™æœŸ
function getLiquidationGracePeriod(address asset) external view returns (uint40);
```
**ä½¿ç”¨åœºæ™¯**ï¼šåè®®æš‚åœåæ¢å¤æ—¶ï¼Œç»™ç”¨æˆ·æ—¶é—´è¡¥å……æŠµæŠ¼å“ã€‚

#### é—ªç”µè´·è´¹ç‡å‡½æ•°

```solidity
// æ›´æ–°é—ªç”µè´·è´¹ç‡ï¼ˆä»… PoolConfiguratorï¼‰
function updateFlashloanPremium(uint128 flashLoanPremium) external;
// flashLoanPremium ä»¥ bps è¡¨ç¤ºï¼Œ5 = 0.05%

// è·å–æ€»è´¹ç‡
function FLASHLOAN_PREMIUM_TOTAL() external view returns (uint128);

// è·å–åè®®æ”¶å–çš„è´¹ç‡ï¼ˆV3.4 èµ·å§‹ç»ˆä¸º 100%ï¼‰
function FLASHLOAN_PREMIUM_TO_PROTOCOL() external view returns (uint128);
```

#### å›½åº“å‡½æ•°

```solidity
// å°†ç´¯ç§¯çš„å‚¨å¤‡å› å­åˆ©æ¯é“¸é€ ä¸º aToken å‘é€åˆ°å›½åº“
function mintToTreasury(address[] calldata assets) external;

// æ•‘æ´è¯¯å‘é€åˆ° Pool çš„ä»£å¸ï¼ˆä»… Pool Adminï¼‰
function rescueTokens(
    address token,
    address to,
    uint256 amount
) external;
```

---

## ğŸ“ˆ åˆ©ç‡æ¨¡å‹

### ç®—æ³•æ¦‚è¿°

```
åˆ©ç‡ = åŸºç¡€åˆ©ç‡ + åˆ©ç”¨ç‡ Ã— æ–œç‡

å½“åˆ©ç”¨ç‡ < æœ€ä¼˜ç‚¹ï¼š
  å€Ÿæ¬¾åˆ©ç‡ = åŸºç¡€åˆ©ç‡ + åˆ©ç”¨ç‡ Ã— æ–œç‡1ï¼ˆç¼“æ…¢å¢é•¿ï¼‰

å½“åˆ©ç”¨ç‡ > æœ€ä¼˜ç‚¹ï¼š
  å€Ÿæ¬¾åˆ©ç‡ = åŸºç¡€åˆ©ç‡ + æœ€ä¼˜ç‚¹Ã—æ–œç‡1 + (åˆ©ç”¨ç‡-æœ€ä¼˜ç‚¹) Ã— æ–œç‡2ï¼ˆå¿«é€Ÿå¢é•¿ï¼‰
```

### è§†è§‰åŒ–

```
åˆ©ç‡
 â†‘                           â•±
 â”‚                          â•±
 â”‚                        â•±
 â”‚               â•±â•±â•±â•±â•±â•±â•±
 â”‚        â•±â•±â•±â•±â•±
 â”‚  â•±â•±â•±â•±
 â”‚___________________________________â†’ åˆ©ç”¨ç‡
        æœ€ä¼˜ç‚¹ï¼ˆå¦‚ 80%ï¼‰
```

### V3.1 çŠ¶æ€åŒ–åˆ©ç‡ç­–ç•¥
- æ‰€æœ‰èµ„äº§ä½¿ç”¨å•ä¸€åˆ©ç‡ç­–ç•¥åˆçº¦
- å‚æ•°å­˜å‚¨åœ¨åˆçº¦æ˜ å°„ä¸­ï¼Œè€Œéå•ç‹¬éƒ¨ç½²
- åˆ©ç‡ä¸Šé™ï¼šåŸºç¡€åˆ©ç‡ + æ–œç‡1 + æ–œç‡2 â‰¤ 1000%

---

## ğŸ“Š æ•°æ®æŸ¥è¯¢åŠŸèƒ½

### ç”¨æˆ·æ•°æ®æŸ¥è¯¢

```solidity
// è·å–ç”¨æˆ·è´¦æˆ·æ¦‚è§ˆ
function getUserAccountData(address user) external view returns (
    uint256 totalCollateralBase,       // æ€»æŠµæŠ¼å“ä»·å€¼ï¼ˆä»¥åŸºç¡€è´§å¸è®¡ï¼‰
    uint256 totalDebtBase,             // æ€»å€ºåŠ¡ä»·å€¼
    uint256 availableBorrowsBase,      // å¯å€Ÿé¢åº¦
    uint256 currentLiquidationThreshold, // å½“å‰æ¸…ç®—é˜ˆå€¼
    uint256 ltv,                       // è´·æ¬¾ä»·å€¼æ¯”
    uint256 healthFactor               // å¥åº·å› å­ï¼ˆ1e18 = 1.0ï¼‰
);

// è·å–ç”¨æˆ·é…ç½®ä½å›¾
function getUserConfiguration(address user) 
    external view returns (DataTypes.UserConfigurationMap memory);
// ä½å›¾è®°å½•ç”¨æˆ·æŒæœ‰/å€Ÿå‡ºçš„èµ„äº§
```

### å‚¨å¤‡æ•°æ®æŸ¥è¯¢

```solidity
// è·å–å‚¨å¤‡å®Œæ•´æ•°æ®
function getReserveData(address asset) 
    external view returns (DataTypes.ReserveDataLegacy memory);

// è·å–å‚¨å¤‡é…ç½®
function getConfiguration(address asset) 
    external view returns (DataTypes.ReserveConfigurationMap memory);

// è·å–æ ‡å‡†åŒ–å­˜æ¬¾æ”¶å…¥ï¼ˆè®¡ç®— aToken ä½™é¢ç”¨ï¼‰
function getReserveNormalizedIncome(address asset) external view returns (uint256);
// å®é™…ä½™é¢ = scaledBalance * normalizedIncome / 1e27

// è·å–æ ‡å‡†åŒ–å¯å˜å€ºåŠ¡ï¼ˆè®¡ç®—å€ºåŠ¡ä½™é¢ç”¨ï¼‰
function getReserveNormalizedVariableDebt(address asset) external view returns (uint256);

// è·å–è™šæ‹Ÿåº•å±‚ä½™é¢ï¼ˆV3.1 è™šæ‹Ÿè®°è´¦ï¼‰
function getVirtualUnderlyingBalance(address asset) external view returns (uint128);

// è·å–æ‰€æœ‰å‚¨å¤‡åœ°å€åˆ—è¡¨
function getReservesList() external view returns (address[] memory);

// è·å–å‚¨å¤‡æ•°é‡ï¼ˆåŒ…å«å·²ç§»é™¤çš„ï¼‰
function getReservesCount() external view returns (uint256);

// é€šè¿‡ ID è·å–å‚¨å¤‡åœ°å€
function getReserveAddressById(uint16 id) external view returns (address);

// å¿«æ·è·å–ä»£å¸åœ°å€ï¼ˆV3.3 æ–°å¢ï¼ŒèŠ‚çœ Gasï¼‰
function getReserveAToken(address asset) external view returns (address);
function getReserveVariableDebtToken(address asset) external view returns (address);
```

### åè®®å¸¸é‡å’Œåœ°å€

```solidity
// åœ°å€æä¾›è€…
function ADDRESSES_PROVIDER() external view returns (IPoolAddressesProvider);

// åˆ©ç‡ç­–ç•¥åœ°å€
function RESERVE_INTEREST_RATE_STRATEGY() external view returns (address);

// é—ªç”µè´·è´¹ç‡ï¼ˆbpsï¼‰
function FLASHLOAN_PREMIUM_TOTAL() external view returns (uint128);
function FLASHLOAN_PREMIUM_TO_PROTOCOL() external view returns (uint128);

// æœ€å¤§å‚¨å¤‡æ•°é‡
function MAX_NUMBER_RESERVES() external view returns (uint16);
```

### é€»è¾‘åº“åœ°å€æŸ¥è¯¢

```solidity
function getFlashLoanLogic() external view returns (address);
function getBorrowLogic() external view returns (address);
function getEModeLogic() external view returns (address);
function getLiquidationLogic() external view returns (address);
function getPoolLogic() external view returns (address);
function getSupplyLogic() external view returns (address);
```
**ç”¨é€”**ï¼šéªŒè¯å‡çº§ã€è°ƒè¯•ã€æ„å»ºäº¤æ˜“ç­‰ã€‚

---

## ğŸ’¡ äº§å“ä»·å€¼æ€»ç»“

### å¯¹äºå­˜æ¬¾äºº
| ä»·å€¼ | æè¿° |
|-----|-----|
| ğŸ† è¢«åŠ¨æ”¶ç›Š | æ— éœ€ä¸»åŠ¨ç®¡ç†ï¼Œè‡ªåŠ¨èµšå–åˆ©æ¯ |
| ğŸ”“ æµåŠ¨æ€§ | éšæ—¶å­˜å–ï¼Œæ— é”å®šæœŸ |
| ğŸ”„ å¯ç»„åˆæ€§ | aToken å¯ç”¨äºå…¶ä»– DeFi |
| ğŸ›¡ï¸ å®‰å…¨æ€§ | å¤šé‡å®¡è®¡ï¼Œä¹…ç»è€ƒéªŒ |

### å¯¹äºå€Ÿæ¬¾äºº
| ä»·å€¼ | æè¿° |
|-----|-----|
| ğŸ’ª ä¿æŒæ•å£ | ä¸å–èµ„äº§ä¹Ÿèƒ½è·å¾—æµåŠ¨æ€§ |
| ğŸ“Š çµæ´»æ æ† | æ ¹æ®é£é™©åå¥½è°ƒæ•´ä»“ä½ |
| â° æ— æœŸé™ | æ— è¿˜æ¬¾æˆªæ­¢æ—¥æœŸ |
| ğŸ’° ç¨åŠ¡ä¼˜åŒ– | é¿å…å–å‡ºè§¦å‘åº”ç¨äº‹ä»¶ |

### å¯¹äºæ¸…ç®—äºº
| ä»·å€¼ | æè¿° |
|-----|-----|
| ğŸ’µ åˆ©æ¶¦æœºä¼š | 5-10% æ¸…ç®—å¥–åŠ± |
| ğŸ¤– å¯è‡ªåŠ¨åŒ– | æ¸…ç®—æœºå™¨äºº 24/7 è¿è¡Œ |
| âš¡ é—ªç”µè´·æ”¯æŒ | æ— éœ€è‡ªæœ‰èµ„é‡‘å³å¯æ¸…ç®— |

### å¯¹äºå¼€å‘è€…
| ä»·å€¼ | æè¿° |
|-----|-----|
| âš¡ é—ªç”µè´· | å•äº¤æ˜“æ— æŠµæŠ¼å€Ÿè´· |
| ğŸ”Œ å¯ç»„åˆ | æ ‡å‡†åŒ–æ¥å£ï¼Œæ˜“äºé›†æˆ |
| ğŸ“š æ–‡æ¡£å®Œå–„ | è¯¦ç»†çš„å¼€å‘è€…æ–‡æ¡£ |

---

## ğŸ” å®‰å…¨æœºåˆ¶ä¸€è§ˆ

| æœºåˆ¶ | æè¿° | å¼•å…¥ç‰ˆæœ¬ |
|-----|-----|---------|
| **è™šæ‹Ÿè®°è´¦** | é˜²æ­¢æèµ æ”»å‡»æ“æ§åè®®çŠ¶æ€ | V3.1 |
| **æ¸…ç®—å®½é™æœŸ** | åè®®æ¢å¤åç»™ç”¨æˆ·è¡¥å……æŠµæŠ¼å“çš„æ—¶é—´ | V3.1 |
| **å†»ç»“æ—¶ LTV=0** | å†»ç»“èµ„äº§æ— æ³•ç”¨äºå¢åŠ å€Ÿæ¬¾ | V3.1 |
| **éš”ç¦»æ¨¡å¼** | é™åˆ¶æ–°èµ„äº§çš„é£é™©æ•å£ | V3.0 |
| **å€ºåŠ¡ä¸Šé™** | é™åˆ¶å•ä¸€èµ„äº§çš„æœ€å¤§å€ºåŠ¡ | V3.0 |
| **ä¾›åº”ä¸Šé™** | é™åˆ¶å•ä¸€èµ„äº§çš„æœ€å¤§å­˜æ¬¾ | V3.0 |
| **ç´§æ€¥æš‚åœ** | å‘ç°é—®é¢˜æ—¶å¯ç«‹å³åœæ­¢åè®® | V3.0 |
| **åè´¦è¿½è¸ª** | è‡ªåŠ¨è®°å½•å’Œå¤„ç†åè´¦ | V3.3 |
| **æœ€å°å°æ•°ä½** | ä¸Šæ¶èµ„äº§å¿…é¡»è‡³å°‘ 6 ä½å°æ•° | V3.1 |

---

## ğŸ“š ç‰ˆæœ¬æ¼”è¿›

### V3.1 ä¸»è¦ç‰¹æ€§
- è™šæ‹Ÿè®°è´¦ï¼ˆVirtual Accountingï¼‰
- çŠ¶æ€åŒ–åˆ©ç‡ç­–ç•¥
- æ¸…ç®—å®½é™æœŸ
- å†»ç»“æ—¶ LTV ç½®é›¶

### V3.2 ä¸»è¦ç‰¹æ€§
- ç¨³å®šåˆ©ç‡å®Œå…¨åºŸå¼ƒ
- Liquid eModeï¼ˆçµæ´»é«˜æ•ˆæ¨¡å¼ï¼‰

### V3.3 ä¸»è¦ç‰¹æ€§
- åè´¦ç®¡ç†æœºåˆ¶
- æ¸…ç®—é€»è¾‘ä¼˜åŒ–ï¼ˆå…³é—­å› å­é‡è®¾è®¡ï¼‰
- ä½å›¾è®¿é—®ä¼˜åŒ–
- æ–°å¢ä¸“ç”¨ getter å‡½æ•°

### V3.4 ä¸»è¦ç‰¹æ€§
- ç§»é™¤è‡ªå®šä¹‰ GHO é€»è¾‘
- æ–°å¢ Multicall æ”¯æŒ
- Position Managerï¼ˆä»“ä½ç®¡ç†å™¨ï¼‰

### V3.5 ä¸»è¦ç‰¹æ€§
- å¯é¢„æµ‹çš„èˆå…¥è¡Œä¸º

---

## ğŸ”— ç›¸å…³èµ„æº

- [Aave V3 æŠ€æœ¯ç™½çš®ä¹¦](./Aave_V3_Technical_Paper.pdf)
- [V3.1 ç‰¹æ€§æ–‡æ¡£](./3.1/Aave-v3.1-features.md)
- [V3.2 ç‰¹æ€§æ–‡æ¡£](./3.2/Aave-v3.2-features.md)
- [V3.3 ç‰¹æ€§æ–‡æ¡£](./3.3/Aave-v3.3-features.md)
- [V3.4 ç‰¹æ€§æ–‡æ¡£](./3.4/Aave-v3.4-features.md)
- [V3.5 ç‰¹æ€§æ–‡æ¡£](./3.5/Aave-v3.5-features.md)
- [StataToken æ–‡æ¡£](../src/contracts/extensions/stata-token/README.md)
- [é…ç½®å¼•æ“æ–‡æ¡£](../src/contracts/extensions/v3-config-engine/README.md)

---

## ğŸ“‹ æ ¸å¿ƒå‡½æ•°é€ŸæŸ¥è¡¨

### ç”¨æˆ·æ“ä½œå‡½æ•°

| å‡½æ•°å | åŠŸèƒ½ | æƒé™ |
|-------|-----|------|
| `supply(asset, amount, onBehalfOf, referralCode)` | å­˜æ¬¾ | å…¬å¼€ |
| `supplyWithPermit(...)` | ç­¾åå­˜æ¬¾ | å…¬å¼€ |
| `withdraw(asset, amount, to)` | å–æ¬¾ | å…¬å¼€ |
| `borrow(asset, amount, interestRateMode, referralCode, onBehalfOf)` | å€Ÿæ¬¾ | å…¬å¼€ |
| `repay(asset, amount, interestRateMode, onBehalfOf)` | è¿˜æ¬¾ | å…¬å¼€ |
| `repayWithPermit(...)` | ç­¾åè¿˜æ¬¾ | å…¬å¼€ |
| `repayWithATokens(asset, amount, interestRateMode)` | ç”¨ aToken è¿˜æ¬¾ | å…¬å¼€ |
| `setUserUseReserveAsCollateral(asset, useAsCollateral)` | è®¾ç½®æŠµæŠ¼å“ | å…¬å¼€ |
| `setUserEMode(categoryId)` | è®¾ç½® eMode | å…¬å¼€ |
| `liquidationCall(...)` | æ¸…ç®— | å…¬å¼€ |
| `flashLoan(...)` | å¤šèµ„äº§é—ªç”µè´· | å…¬å¼€ |
| `flashLoanSimple(...)` | å•èµ„äº§é—ªç”µè´· | å…¬å¼€ |

### ä»“ä½ç®¡ç†å™¨å‡½æ•°ï¼ˆV3.4+ï¼‰

| å‡½æ•°å | åŠŸèƒ½ | æƒé™ |
|-------|-----|------|
| `approvePositionManager(positionManager, approve)` | æˆæƒä»“ä½ç®¡ç†å™¨ | å…¬å¼€ |
| `renouncePositionManagerRole(user)` | æ”¾å¼ƒç®¡ç†æƒé™ | ä»“ä½ç®¡ç†å™¨ |
| `setUserUseReserveAsCollateralOnBehalfOf(...)` | ä»£ä¸ºè®¾ç½®æŠµæŠ¼å“ | ä»“ä½ç®¡ç†å™¨ |
| `setUserEModeOnBehalfOf(categoryId, onBehalfOf)` | ä»£ä¸ºè®¾ç½® eMode | ä»“ä½ç®¡ç†å™¨ |
| `isApprovedPositionManager(user, positionManager)` | æŸ¥è¯¢æˆæƒçŠ¶æ€ | å…¬å¼€ |

### èµ¤å­—ç®¡ç†å‡½æ•°ï¼ˆV3.3+ï¼‰

| å‡½æ•°å | åŠŸèƒ½ | æƒé™ |
|-------|-----|------|
| `eliminateReserveDeficit(asset, amount)` | è¦†ç›–èµ¤å­— | Umbrella |
| `getReserveDeficit(asset)` | æŸ¥è¯¢èµ¤å­— | å…¬å¼€ |

### æŸ¥è¯¢å‡½æ•°

| å‡½æ•°å | è¿”å›å€¼ |
|-------|-------|
| `getUserAccountData(user)` | ç”¨æˆ·è´¦æˆ·æ¦‚è§ˆ |
| `getUserConfiguration(user)` | ç”¨æˆ·é…ç½®ä½å›¾ |
| `getReserveData(asset)` | å‚¨å¤‡å®Œæ•´æ•°æ® |
| `getConfiguration(asset)` | å‚¨å¤‡é…ç½® |
| `getReserveNormalizedIncome(asset)` | å­˜æ¬¾æŒ‡æ•° |
| `getReserveNormalizedVariableDebt(asset)` | å€ºåŠ¡æŒ‡æ•° |
| `getVirtualUnderlyingBalance(asset)` | è™šæ‹Ÿä½™é¢ |
| `getReservesList()` | å‚¨å¤‡åˆ—è¡¨ |
| `getReserveAToken(asset)` | aToken åœ°å€ |
| `getReserveVariableDebtToken(asset)` | å€ºåŠ¡ä»£å¸åœ°å€ |
| `getUserEMode(user)` | ç”¨æˆ· eMode |
| `getEModeCategoryCollateralConfig(id)` | eMode æŠµæŠ¼é…ç½® |
| `getEModeCategoryLabel(id)` | eMode æ ‡ç­¾ |
| `getLiquidationGracePeriod(asset)` | æ¸…ç®—å®½é™æœŸ |

### ç®¡ç†å‡½æ•°ï¼ˆä»… PoolConfiguratorï¼‰

| å‡½æ•°å | åŠŸèƒ½ |
|-------|-----|
| `initReserve(...)` | åˆå§‹åŒ–å‚¨å¤‡ |
| `dropReserve(asset)` | ç§»é™¤å‚¨å¤‡ |
| `setConfiguration(...)` | è®¾ç½®é…ç½® |
| `syncIndexesState(asset)` | åŒæ­¥æŒ‡æ•° |
| `syncRatesState(asset)` | åŒæ­¥åˆ©ç‡ |
| `setLiquidationGracePeriod(asset, until)` | è®¾ç½®å®½é™æœŸ |
| `updateFlashloanPremium(premium)` | æ›´æ–°é—ªç”µè´·è´¹ç‡ |
| `configureEModeCategory(...)` | é…ç½® eMode |

---

*æœ¬æ–‡æ¡£åŸºäº Aave V3.5 ä»£ç åº“ç¼–å†™ï¼Œæœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´12æœˆ*

