---
alwaysApply: true
---
# Aave V3.5 é¡¹ç›®æ–‡æ¡£è§„èŒƒ

## ğŸ“ ä»£ç æ³¨é‡Šï¼ˆNatSpecï¼‰

### åŸºæœ¬æ ¼å¼

#### åˆçº¦çº§åˆ«æ³¨é‡Š
```solidity
/**
 * @title Pool contract
 * @author Aave
 * @notice Main point of interaction with an Aave protocol's market
 * - Users can:
 *   # Supply
 *   # Withdraw
 *   # Borrow
 *   # Repay
 * @dev To be covered by a proxy contract, owned by the PoolAddressesProvider
 * @dev All admin functions are callable by the PoolConfigurator contract
 */
abstract contract Pool {
    // ...
}
```

#### åº“çº§åˆ«æ³¨é‡Š
```solidity
/**
 * @title SupplyLogic library
 * @author Aave
 * @notice Implements the base logic for supply/withdraw
 */
library SupplyLogic {
    // ...
}
```

#### æ¥å£çº§åˆ«æ³¨é‡Š
```solidity
/// @title IRevenueSplitter
/// @notice Interface for RevenueSplitter contract
/// @dev The `RevenueSplitter` is a state-less non-upgradeable contract that supports 2 recipients
/// @dev Warning: For recipients, you can use any address, but preferable to use `Collector`
interface IRevenueSplitter {
    // ...
}
```

### å‡½æ•°æ³¨é‡Šè§„èŒƒ

#### å…¬å…±/å¤–éƒ¨å‡½æ•°
```solidity
/**
 * @notice Implements the supply feature. Through `supply()`, users supply assets to the Aave protocol.
 * @dev Emits the `Supply()` event.
 * @dev In the first supply action, `ReserveUsedAsCollateralEnabled()` is emitted, if the asset can be enabled as collateral.
 * @param reservesData The state of all the reserves
 * @param reservesList The addresses of all the active reserves
 * @param userConfig The user configuration mapping that tracks the supplied/borrowed assets
 * @param params The additional parameters needed to execute the supply function
 */
function executeSupply(
    mapping(address => DataTypes.ReserveData) storage reservesData,
    mapping(uint256 => address) storage reservesList,
    DataTypes.UserConfigurationMap storage userConfig,
    DataTypes.ExecuteSupplyParams memory params
) external {
    // ...
}
```

#### æ¥å£å‡½æ•°æ³¨é‡Š
```solidity
/// @notice Split token balances in RevenueSplitter and transfer between two recipients
/// @param tokens List of tokens to check balance and split amounts
/// @dev Specs:
///      - Does not revert if token balance is zero (no-op).
///      - Rounds in favor of RECIPIENT_B (1 wei round).
///      - Anyone can call this function anytime.
function splitRevenue(IERC20[] memory tokens) external;
```

### NatSpec æ ‡ç­¾è¯´æ˜

#### å¿…éœ€æ ‡ç­¾
- `@title`: åˆçº¦/åº“/æ¥å£çš„ç®€çŸ­æ ‡é¢˜
- `@author`: ä½œè€…æˆ–å›¢é˜Ÿåç§°ï¼ˆå¦‚ "Aave", "BGD Labs"ï¼‰
- `@notice`: ç”¨æˆ·å¯è§çš„ç®€çŸ­æè¿°ï¼ˆå‡ºç°åœ¨ ABI ä¸­ï¼‰
- `@dev`: å¼€å‘è€…è¯´æ˜ï¼ŒåŒ…å«å®ç°ç»†èŠ‚ã€è­¦å‘Šã€æ³¨æ„äº‹é¡¹

#### å¯é€‰æ ‡ç­¾
- `@param <paramName> <description>`: å‚æ•°è¯´æ˜ï¼ˆå‡½æ•°å¿…é¡»æœ‰ï¼‰
- `@return <description>`: è¿”å›å€¼è¯´æ˜ï¼ˆæœ‰è¿”å›å€¼æ—¶å¿…é¡»ï¼‰
- `@inheritdoc <contract>`: ç»§æ‰¿çˆ¶åˆçº¦çš„æ–‡æ¡£
- `@custom:security`: å®‰å…¨ç›¸å…³è¯´æ˜
- `@custom:warning`: é‡è¦è­¦å‘Šä¿¡æ¯

#### âš ï¸ æµ‹è¯•æ–‡ä»¶ä¾‹å¤–
**`tests/` ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸éœ€è¦éµå¾ª NatSpec è§„èŒƒ**ï¼š
- æµ‹è¯•å‡½æ•°ï¼ˆ`test_*`ï¼‰ä¸éœ€è¦ `@notice` æ ‡ç­¾
- æµ‹è¯•åˆçº¦ä¸éœ€è¦ `@title`ã€`@author`ã€`@notice` æ ‡ç­¾
- æµ‹è¯•è¾…åŠ©å‡½æ•°å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ³¨é‡Šï¼Œä½†ä¸æ˜¯å¿…éœ€çš„
- æµ‹è¯•æ–‡ä»¶çš„ä¸»è¦ç›®çš„æ˜¯éªŒè¯åŠŸèƒ½ï¼Œå‡½æ•°åé€šå¸¸å·²ç»è¶³å¤Ÿæè¿°æµ‹è¯•å†…å®¹

### ä¿®é¥°ç¬¦æ³¨é‡Š
```solidity
/**
 * @dev Only pool configurator can call functions marked by this modifier.
 */
modifier onlyPoolConfigurator() {
    _onlyPoolConfigurator();
    _;
}
```

### é”™è¯¯å®šä¹‰æ³¨é‡Š
```solidity
/**
 * @dev Withdraw amount exceeds available balance
 */
error BalanceExceeded();

/**
 * @dev Indicates a failure with the `spender`'s `allowance`.
 * @param spender Address that may be allowed to operate on tokens
 * @param allowance Amount of tokens a `spender` is allowed to operate with
 * @param needed Minimum amount required to perform a transfer
 */
error ERC20InsufficientAllowance(address spender, uint256 allowance, uint256 needed);
```

### äº‹ä»¶æ³¨é‡Š
```solidity
/**
 * @notice Emitted when the new stream is created
 * @param streamId The identifier of the stream
 * @param sender The address of the collector
 * @param recipient The address towards which the money is streamed
 * @param deposit The amount of money to be streamed
 * @param tokenAddress The ERC20 token to use as streaming currency
 * @param startTime The unix timestamp for when the stream starts
 * @param stopTime The unix timestamp for when the stream stops
 */
event CreateStream(
    uint256 indexed streamId,
    address indexed sender,
    address indexed recipient,
    uint256 deposit,
    address tokenAddress,
    uint256 startTime,
    uint256 stopTime
);
```

### è¡Œå†…æ³¨é‡Šè§„èŒƒ
```solidity
// âœ… å¥½çš„æ³¨é‡Šï¼šè§£é‡Š"ä¸ºä»€ä¹ˆ"è€Œä¸æ˜¯"æ˜¯ä»€ä¹ˆ"
// As aToken.mint rounds down the minted shares, we ensure an equivalent of <= params.amount shares is minted.
bool isFirstSupply = IAToken(reserveCache.aTokenAddress).mint(...);

// âœ… å¥½çš„æ³¨é‡Šï¼šè¯´æ˜å¤æ‚é€»è¾‘
// Update state before external calls to prevent reentrancy
reserve.updateState(reserveCache);

// âŒ é¿å…ï¼šæ˜¾è€Œæ˜“è§çš„æ³¨é‡Š
// Increment counter
counter++;
```

### æ³¨é‡Šè¯­è¨€
- **å…¬å…±æ¥å£å’Œç”¨æˆ·æ–‡æ¡£**: ä½¿ç”¨è‹±æ–‡ï¼ˆå‡ºç°åœ¨ ABI ä¸­ï¼‰
- **å†…éƒ¨å®ç°æ³¨é‡Š**: å¯ä»¥ä½¿ç”¨ä¸­æ–‡æˆ–è‹±æ–‡ï¼ˆæ ¹æ®å›¢é˜Ÿä¹ æƒ¯ï¼‰
- **ä¸€è‡´æ€§**: åŒä¸€æ–‡ä»¶å†…ä¿æŒè¯­è¨€ä¸€è‡´

---

## ğŸ“š README æ–‡æ¡£è§„èŒƒ

### README æ–‡ä»¶ä½ç½®
- **æ‰©å±•åŠŸèƒ½**: `src/contracts/extensions/<feature>/README.md`
- **åº“å’Œå·¥å…·**: é‡è¦åº“å¯ä»¥åŒ…å« README
- **é¡¹ç›®æ ¹ç›®å½•**: `README.md` åŒ…å«é¡¹ç›®æ¦‚è¿°

### README ç»“æ„æ¨¡æ¿
```markdown
# Feature Name

## Overview
Brief description of what this feature/contract does.

## Architecture
High-level architecture explanation, optionally with diagrams.

## Usage
How to use this feature, with code examples.

## Security Considerations
Important security notes and warnings.

## Limitations
Known limitations and constraints.

## Upgrade Notes
If applicable, notes about upgrades and migrations.
```

### å®é™…ç¤ºä¾‹ï¼ˆåŸºäºé¡¹ç›®ï¼‰
```markdown
## Aave v3 config engine

![Config Engine Diagram](../../../../resources/configs-engine.svg)

## What is the AaveV3ConfigEngine?

The `AaveV3ConfigEngine` is a helper smart contract to abstract good practices when doing "admin" interactions with the Aave v3 protocol.

## How to use the engine?

The engine is not designed to be used directly when writing a payload, but through abstract contracts that we will call `Base Aave v3 Payloads`.

## Security procedures

For this project, the security procedures applied/being finished are:
- The test suite of the codebase itself.
- Certora audit/property checking for all the dynamics.
```

### README ç¼–å†™è¦ç‚¹
- **æ¸…æ™°çš„ç»“æ„**: ä½¿ç”¨æ ‡é¢˜å±‚çº§ç»„ç»‡å†…å®¹
- **ä»£ç ç¤ºä¾‹**: æä¾›å®é™…å¯ç”¨çš„ä»£ç ç¤ºä¾‹
- **å›¾è¡¨**: ä½¿ç”¨ Mermaid æˆ– SVG å›¾è¡¨è¯´æ˜æ¶æ„
- **å®‰å…¨è¯´æ˜**: æ˜ç¡®æ ‡æ³¨å®‰å…¨æ³¨æ„äº‹é¡¹å’Œé™åˆ¶
- **ç‰ˆæœ¬ä¿¡æ¯**: å¦‚æœé€‚ç”¨ï¼Œè¯´æ˜ç‰ˆæœ¬å’Œå‡çº§è·¯å¾„

---

## ğŸ“– Markdown æ–‡æ¡£è§„èŒƒ

### æ–‡æ¡£ä½ç½®
- **æŠ€æœ¯æ–‡æ¡£**: `docs/` ç›®å½•ï¼ˆç‰ˆæœ¬ç‰¹æ€§æ–‡æ¡£ï¼‰
- **é¡¹ç›®æ–‡æ¡£**: æ ¹ç›®å½•æˆ–ç›¸å…³ç›®å½•çš„ `.md` æ–‡ä»¶
- **ä»£ç æ³¨é‡Š**: ä¸ä»£ç ä¸€èµ·ç»´æŠ¤

### Markdown æ ¼å¼è§„èŒƒ

#### æ ‡é¢˜å±‚çº§
```markdown
# ä¸€çº§æ ‡é¢˜ï¼ˆæ–‡æ¡£æ ‡é¢˜ï¼‰
## äºŒçº§æ ‡é¢˜ï¼ˆä¸»è¦ç« èŠ‚ï¼‰
### ä¸‰çº§æ ‡é¢˜ï¼ˆå­ç« èŠ‚ï¼‰
#### å››çº§æ ‡é¢˜ï¼ˆå°èŠ‚ï¼‰
```

#### ä»£ç å—
```markdown
# Solidity ä»£ç 
```solidity
contract Example {
    function example() external {}
}
```

# Bash å‘½ä»¤
```bash
forge test
```

# é…ç½®æ–‡ä»¶
```toml
[profile.default]
solc = '0.8.27'
```
```

#### åˆ—è¡¨å’Œè¡¨æ ¼
```markdown
## æ— åºåˆ—è¡¨
- Item 1
- Item 2
  - Sub-item 2.1

## æœ‰åºåˆ—è¡¨
1. First step
2. Second step

## è¡¨æ ¼
| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Value 1  | Value 2  | Value 3  |
```

#### å¼ºè°ƒå’Œå¼•ç”¨
```markdown
**é‡è¦ä¿¡æ¯**: ä½¿ç”¨ç²—ä½“å¼ºè°ƒå…³é”®ç‚¹
*æ–œä½“*: ç”¨äºå¼ºè°ƒæˆ–å¼•ç”¨
> å¼•ç”¨å—: ç”¨äºå¼•ç”¨å…¶ä»–æ–‡æ¡£æˆ–è¯´æ˜
`ä»£ç ç‰‡æ®µ`: ç”¨äºè¡Œå†…ä»£ç å¼•ç”¨
```

### æ–‡æ¡£ç»“æ„æœ€ä½³å®è·µ
- **æ¦‚è¿°**: æ–‡æ¡£å¼€å¤´è¯´æ˜ç›®çš„å’ŒèŒƒå›´
- **ç›®å½•**: é•¿æ–‡æ¡£ä½¿ç”¨ç›®å½•å¯¼èˆª
- **ç« èŠ‚**: ä½¿ç”¨æ¸…æ™°çš„ç« èŠ‚åˆ’åˆ†
- **ç¤ºä¾‹**: æä¾›å®é™…å¯è¿è¡Œçš„ç¤ºä¾‹
- **å‚è€ƒ**: é“¾æ¥åˆ°ç›¸å…³æ–‡æ¡£å’Œèµ„æº

---

## ğŸ” API æ–‡æ¡£ç”Ÿæˆ

### ä½¿ç”¨ NatSpec ç”Ÿæˆ API æ–‡æ¡£
- **å·¥å…·**: Solidity ç¼–è¯‘å™¨å¯ä»¥æå– NatSpec æ³¨é‡Š
- **æ ¼å¼**: ç”Ÿæˆ JSON æ ¼å¼çš„ ABI å’Œæ–‡æ¡£
- **å†…å®¹**: `@notice` å’Œ `@param` ä¼šå‡ºç°åœ¨ç”Ÿæˆçš„æ–‡æ¡£ä¸­

### æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥
- [ ] æ‰€æœ‰å…¬å…±å‡½æ•°éƒ½æœ‰ `@notice` å’Œ `@param` è¯´æ˜ï¼ˆ**æµ‹è¯•æ–‡ä»¶é™¤å¤–**ï¼‰
- [ ] æ‰€æœ‰äº‹ä»¶éƒ½æœ‰ `@notice` å’Œ `@param` è¯´æ˜
- [ ] æ‰€æœ‰é”™è¯¯éƒ½æœ‰ `@dev` è¯´æ˜
- [ ] å¤æ‚é€»è¾‘æœ‰è¡Œå†…æ³¨é‡Š
- [ ] å®‰å…¨ç›¸å…³å‡½æ•°æœ‰ `@custom:security` æˆ– `@dev` è­¦å‘Š

**æ³¨æ„**ï¼š`tests/` ç›®å½•ä¸‹çš„æµ‹è¯•æ–‡ä»¶ä¸éœ€è¦éµå¾ª NatSpec è§„èŒƒï¼Œå¯ä»¥å¿½ç•¥ç›¸å…³çš„ lint è­¦å‘Šã€‚

---

## âš ï¸ æ–‡æ¡£æ³¨æ„äº‹é¡¹

### å¿…é¡»åŒ…å«çš„ä¿¡æ¯
1. **å®‰å…¨è­¦å‘Š**: æ‰€æœ‰æ¶‰åŠèµ„é‡‘æˆ–æƒé™çš„å‡½æ•°å¿…é¡»æœ‰å®‰å…¨è¯´æ˜
2. **å‚æ•°éªŒè¯**: è¯´æ˜å‚æ•°çš„çº¦æŸå’ŒéªŒè¯è§„åˆ™
3. **å‰¯ä½œç”¨**: è¯´æ˜å‡½æ•°æ‰§è¡Œçš„å¤–éƒ¨è°ƒç”¨å’ŒçŠ¶æ€å˜æ›´
4. **Gas æˆæœ¬**: å¯¹äºé«˜ Gas æ“ä½œï¼Œå¯ä»¥æ·»åŠ è¯´æ˜

### é¿å…çš„å¸¸è§é”™è¯¯
1. **è¿‡æ—¶æ³¨é‡Š**: ä»£ç æ›´æ–°æ—¶åŒæ­¥æ›´æ–°æ³¨é‡Š
2. **é‡å¤ä»£ç **: æ³¨é‡Šä¸è¦ç®€å•é‡å¤ä»£ç å†…å®¹
3. **ç¼ºå¤±å‚æ•°è¯´æ˜**: æ‰€æœ‰å‚æ•°å¿…é¡»æœ‰ `@param` è¯´æ˜
4. **ä¸ä¸€è‡´çš„è¯­è¨€**: ä¿æŒæ³¨é‡Šè¯­è¨€ä¸€è‡´
5. **ç¼ºå°‘è¿”å›å€¼è¯´æ˜**: æœ‰è¿”å›å€¼çš„å‡½æ•°å¿…é¡»æœ‰ `@return`

### æ–‡æ¡£ç»´æŠ¤
- **ä»£ç å®¡æŸ¥**: å®¡æŸ¥æ—¶æ£€æŸ¥æ–‡æ¡£å®Œæ•´æ€§
- **æ›´æ–°åŒæ­¥**: ä»£ç å˜æ›´æ—¶åŒæ­¥æ›´æ–°æ–‡æ¡£
- **ç‰ˆæœ¬æ§åˆ¶**: æ–‡æ¡£ä¸ä»£ç ä¸€èµ·ç‰ˆæœ¬æ§åˆ¶
- **å®šæœŸå®¡æŸ¥**: å®šæœŸå®¡æŸ¥æ–‡æ¡£çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§

---
## âš ï¸ å¸¸è§é”™è¯¯é¿å…

1. **ä¸è¦ç›´æ¥ä¿®æ”¹å­˜å‚¨å¸ƒå±€** - å½±å“åˆçº¦å‡çº§
2. **ä¸è¦å¿½ç•¥è®¿é—®æ§åˆ¶** - æ‰€æœ‰å…³é”®å‡½æ•°å¿…é¡»æœ‰æƒé™æ£€æŸ¥
3. **ä¸è¦å¿˜è®°äº‹ä»¶** - æ‰€æœ‰çŠ¶æ€å˜æ›´åº” emit äº‹ä»¶
4. **ä¸è¦ç¡¬ç¼–ç åœ°å€** - ä½¿ç”¨é…ç½®åˆçº¦æˆ–å‚æ•°
5. **ä¸è¦å¿½ç•¥ç²¾åº¦** - ä½¿ç”¨æ•°å­¦åº“è¿›è¡Œç²¾ç¡®è®¡ç®—
6. **ä¸è¦è·³è¿‡æµ‹è¯•** - æ¯ä¸ªåŠŸèƒ½éƒ½éœ€è¦æµ‹è¯•è¦†ç›–
7. **ä¸è¦å¿½ç•¥ Gas ä¼˜åŒ–** - è€ƒè™‘ Gas æˆæœ¬
8. **ä¸è¦å¿˜è®°å¤šé“¾å…¼å®¹æ€§** - æµ‹è¯•ä¸åŒé“¾çš„ç‰¹æ€§

---

## ğŸ“š å‚è€ƒèµ„æº

### NatSpec è§„èŒƒ
- **Solidity NatSpec**: https://docs.soliditylang.org/en/latest/natspec-format.html
- **OpenZeppelin æ–‡æ¡£é£æ ¼**: https://docs.openzeppelin.com/

### Markdown èµ„æº
- **Markdown æŒ‡å—**: https://www.markdownguide.org/
- **GitHub Flavored Markdown**: https://github.github.com/gfm/

### é¡¹ç›®æ–‡æ¡£ç¤ºä¾‹
- **æ‰©å±•åŠŸèƒ½ README**: `src/contracts/extensions/*/README.md`
- **æŠ€æœ¯æ–‡æ¡£**: `docs/` ç›®å½•
- **ä»£ç æ³¨é‡Š**: å‚è€ƒ `src/contracts/protocol/pool/Pool.sol`
